(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e7b62360"],{"1fad":function(e,t,i){},"4bbe":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"confirm_warp"},[t("h4",[e._v(e._s(e.title))]),"5"===e.i?t("div",{staticClass:"opinion"},[t("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.remark,expression:"remark",modifiers:{trim:!0}}],attrs:{name:"",id:"",placeholder:"请输入意见"},domProps:{value:e.remark},on:{input:function(t){t.target.composing||(e.remark=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]):e._e(),"8"===e.i||"2"===e.i||"9"===e.i?t("div",{staticClass:"opinion"},[t("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.remark,expression:"remark",modifiers:{trim:!0}}],attrs:{name:"",id:"",placeholder:"请输入意见"},domProps:{value:e.remark},on:{input:function(t){t.target.composing||(e.remark=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),t("div",{staticClass:"accessory"},[t("span",[e._v("附件")]),t("b",[t("i",{staticClass:"iconfont icon-fujian"},[t("input",{attrs:{multiple:"",type:"file",name:"",id:""},on:{change:e.fileChange}})])])]),t("ul",{staticClass:"file"},e._l(e.files,(function(i,a){return t("li",{key:a},[t("span",[e._v(e._s(i.fileName))]),t("i",{staticClass:"iconfont icon-cha2",on:{click:function(t){return e.delFile(a)}}})])})),0)]):e._e(),"6"===e.i||"6.1"===e.i?t("div",{staticClass:"designate"},[t("div",{staticClass:"item"},[t("p",[e._v("截止时间")]),t("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择截止时间"},domProps:{value:e.formData.cutOffTime},on:{click:e.selectTime}})]),t("div",{staticClass:"item"},[t("p",[e._v("指派部门")]),t("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门"},domProps:{value:e.formData.deptName},on:{click:e.selectDept}}),e.formData.deptName?t("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门人员"},domProps:{value:e.formData.userName.join()},on:{click:e.selectUser}}):e._e()]),t("div",{staticClass:"item"},[t("p",[e._v("协办部门")]),t("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门"},domProps:{value:e.formData.assistName.join()},on:{click:e.selectAssist}})]),t("div",{staticClass:"item"},[t("p",[e._v("报送领导")]),t("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择报送领导"},domProps:{value:e.formData.leaderName.join()},on:{click:e.selectLeader}})]),t("div",{staticClass:"item"},[t("p",[e._v("处置要求")]),t("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.remark,expression:"formData.remark",modifiers:{trim:!0}}],attrs:{name:"",id:"",placeholder:"请输入处置要求"},domProps:{value:e.formData.remark},on:{input:function(t){t.target.composing||e.$set(e.formData,"remark",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})])]):e._e(),"11"===e.i||"11.1"===e.i?t("div",{staticClass:"designate"},[t("div",{staticClass:"item"},[t("p",[e._v("协办部门")]),t("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门"},domProps:{value:e.formData.assistName.join()},on:{click:e.selectAssist}})]),t("div",{staticClass:"item"},[t("p",[e._v("报送领导")]),t("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择报送领导"},domProps:{value:e.formData.leaderName.join()},on:{click:e.selectLeader}})])]):e._e(),t("div",{staticClass:"endHolder"}),t("div",{staticClass:"btn"},[t("span",{on:{click:e.confirm}},[e._v("确认")])])])},s=[],n=(i("14d9"),i("c198")),o={data(){return{i:this.$route.query.i,id:this.$route.query.id,title:"",titles:["","处置情况","申请办结","","","","指派","","","办结"],opinion:"",deptList:[],deptOption:[],userList:[],userOption:[],assistList:[],assistOption:[],leaderList:[],leaderOption:[],remark:"",formData:{remark:"",cutOffTime:"",deptName:"",userName:[],assistName:[],leaderName:[],leaderUserList:[],helpUserList:[]},files:[]}},async created(){dd.disablePullToRefresh().then(e=>{}).catch(e=>{}),this.title=this.titles[this.i];const[e,t]=await Promise.all([Object(n["Yb"])({isLeader:1}),Object(n["Zb"])({workgroupCodeId:"WJGroup",workType:3,permissionNames:this.i%1?"healthEvent:threeRole":"healthEvent:twoRole,healthEvent:threeRole"})]);e.success&&(this.deptList=t.data.departList,this.deptOption=t.data.departList.map(e=>e.name||"-"),t.data.departList.forEach(e=>{e.userList&&e.userList.length&&e.userList.forEach(t=>{t.departmentId=e.id,this.assistList.push(t),this.assistOption.push((e.name||"-")+":"+(t.name||"-"))})}),e.data.departList.forEach(e=>{e.userList&&e.userList.length&&e.userList.forEach(e=>{this.leaderList.push(e),this.leaderOption.push(e.name)})}))},methods:{confirm(){if(5==this.i){let e={eventId:this.id,editDepartmentId:this.$route.query.firstDepartmentId,operationType:10};const t=this;return void dd.device.notification.confirm({message:"是否确定退回?",title:"提示",buttonLabels:["取消","确定"],onSuccess(i){1===i.buttonIndex&&dd.device.notification.showPreloader({text:"处理中..",showIcon:!0,async onSuccess(i){const a=await Object(n["j"])(e);dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}}),a.success&&dd.alert({message:a.message?a.message:"操作成功",title:"提示",button:"收到"}).then(e=>{t.$router.go(-1)}).catch(e=>{})},onFail:function(e){}})},onFail:function(e){}})}if(1==this.i||2==this.i||9==this.i){let e={rbacToken:localStorage.getItem("rbacToken"),remark:this.remark,eventId:this.id,handleType:this.$route.query.handleType,handleDepartmentId:this.$route.query.handleDepartmentId,operationType:4*this.i,authName:"emergencyHandleManagement:supplementaryExplanation",editDepartmentId:this.$route.query.handleDepartmentId};9==this.i&&(e.operationType=5),this.files.length?(e.isFile=1,e.handleFileListStr=JSON.stringify(this.files)):e.isFile=0;const t=this;return void dd.device.notification.confirm({message:"确定提交?",title:"提示",buttonLabels:["取消","确定"],onSuccess(i){1===i.buttonIndex&&dd.device.notification.showPreloader({text:"提交中..",showIcon:!0,async onSuccess(i){const a=await Object(n["l"])(e);dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}}),a.success&&dd.alert({message:a.message?a.message:"操作成功",title:"提示",button:"收到"}).then(e=>{"9"!==t.i?t.$router.go(-t.i):t.$router.go(-2)}).catch(e=>{})},onFail:function(e){}})},onFail:function(e){}})}if(8==this.i){let e={isFile:this.files.length?1:0,remark:this.remark,eventId:this.id,handleType:1,departmentId:this.$route.query.handleDepartmentId,editDepartmentId:this.$route.query.firstDepartmentId,operationType:4,authName:"emergencyHandleManagement:supplementaryExplanation"};const t=this;return void dd.device.notification.confirm({message:"是否确定新增处置?",title:"提示",buttonLabels:["取消","确定"],onSuccess(i){1===i.buttonIndex&&dd.device.notification.showPreloader({text:"处理中..",showIcon:!0,async onSuccess(i){const a=await Object(n["l"])(e);dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}}),a.success&&dd.alert({message:a.message?a.message:"操作成功",title:"提示",button:"收到"}).then(e=>{t.$router.go(-1)}).catch(e=>{})},onFail:function(e){}})},onFail:function(e){}})}if(11==this.i||11.1==this.i){if(!this.formData.helpUserList.length)return void this.alert("请选择部门及人员");let e={dingLinkUrl:"https://pazht.ouhai.gov.cn:8000/fyDingtalkWeb/index.html#/listing/3",departmentId:this.$route.query.handleDepartmentId,editDepartmentId:this.$route.query.firstDepartmentId,eventId:this.id,helpUserList:this.formData.helpUserList,operationType:2,authName:"emergencyHandleManagement:supplementaryExplanation"};const t=this;return void dd.device.notification.confirm({message:"是否确定新增协办?",title:"提示",buttonLabels:["取消","确定"],onSuccess(i){1===i.buttonIndex&&dd.device.notification.showPreloader({text:"处理中..",showIcon:!0,async onSuccess(i){const a=await Object(n["k"])(e);dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}}),a.success&&dd.alert({message:a.message?a.message:"操作成功",title:"提示",button:"收到"}).then(e=>{t.$router.go(-1)}).catch(e=>{})},onFail:function(e){}})},onFail:function(e){}})}if(!this.formData.userName.length)return void this.alert("请指派部门及人员");const e=this;e.formData.operationType=3,e.formData.eventId=this.id,e.formData.handleDepartmentId=this.$route.query.handleDepartmentId,e.formData.dingLinkUrl="https://pazht.ouhai.gov.cn:8000/fyDingtalkWeb/index.html#/listing/3",dd.device.notification.confirm({message:"确定指派？",title:"提示",buttonLabels:["取消","确定"],async onSuccess(t){t.buttonIndex&&dd.device.notification.showPreloader({text:"指派中..",showIcon:!0,async onSuccess(t){const i=await Object(n["k"])(e.formData);if(i.success){await Object(n["k"])({departmentId:"8d406cedc99448b3a68b7033a92487be",eventId:e.id,handleType:1,operationType:4,remark:e.formData.remark});dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}})}else dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}});i.success&&dd.alert({message:i.message?i.message:"操作成功",title:"提示",button:"收到"}).then(t=>{e.$router.go(-2)}).catch(e=>{})},onFail:function(e){}})},onFail:function(e){}})},async fileChange(e){let t=new FormData;const i=[...e.target.files];if(i&&i.length){dd.device.notification.showPreloader({text:"文件上传中..",showIcon:!0,onSuccess(e){}}),i.forEach(e=>{t.append("file",e)}),t.append("rbacToken",localStorage.getItem("rbacToken"));const e=await Object(n["gc"])(t);dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}}),e.success&&e.data&&e.data.length&&e.data.forEach((e,t)=>{var a={};a.fileType=i[t].type,a.fileName=i[t].name,a.fileId=e,this.files.push(a)})}},delFile(e){this.files.splice(e,1)},selectTime(){const e=this,t=new Date;t.getFullYear(),String(t.getMonth()+1).padStart(2,0),String(t.getDate()).padStart(2,0);dd.showDatePicker({format:"yyyy-MM-dd",value:e.formData.incidentTime}).then(t=>{e.formData.cutOffTime=t.value}).catch(e=>{})},selectDept(){const e=this;dd.device.notification.actionSheet({title:"选择指派部门？",cancelButton:"取消",otherButtons:e.deptOption,onSuccess:function(t){-1!==t.buttonIndex&&(e.formData.userName=[],e.formData.operationId=e.deptList[t.buttonIndex].id,e.formData.departmentId=e.deptList[t.buttonIndex].id,e.formData.deptName=e.deptOption[t.buttonIndex],e.userList=e.deptList[t.buttonIndex].userList,e.userOption=e.userList.map(e=>e.name))},onFail:function(e){}})},selectUser(){const e=this;dd.biz.util.multiSelect({options:e.userOption,selectOption:e.formData.userName,onSuccess:function(t){-1!==t.buttonIndex&&(e.formData.mainUserList=[],e.formData.userName=t.map(t=>(e.formData.mainUserList.push(e.userList[t]),e.userOption[t])))},onFail:function(){}})},selectAssist(){const e=this;dd.biz.util.multiSelect({options:e.assistOption,selectOption:e.formData.assistName,onSuccess(t){-1!==t.buttonIndex&&(e.formData.helpUserList=[],e.formData.assistName=t.map(t=>(e.formData.helpUserList.push(e.assistList[t]),e.assistOption[t])))},onFail:function(){}})},selectLeader(){const e=this;dd.biz.util.multiSelect({options:e.leaderOption,selectOption:e.formData.leaderName,onSuccess(t){-1!==t.buttonIndex&&(e.formData.leaderUserList=[],e.formData.leaderName=t.map(t=>(e.formData.leaderUserList.push(e.leaderList[t]),e.leaderOption[t])))},onFail:function(){}})},alert(e){dd.device.notification.alert({message:e,title:"提示",buttonName:"确定"})}}},r=o,c=(i("cd87"),i("2877")),d=Object(c["a"])(r,a,s,!1,null,"739b6968",null);t["default"]=d.exports},cd87:function(e,t,i){"use strict";i("1fad")}}]);