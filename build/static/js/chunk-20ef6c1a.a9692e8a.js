(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-20ef6c1a"],{"56a4":function(e,t,a){"use strict";a("8c8a")},8152:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"event_warp"},[t("div",{staticClass:"detailMsg"},[e._m(0),t("ul",{staticClass:"ul"},[t("li",{staticClass:"li"},[t("span",[e._v("上报人员")]),t("div",[e._v(" "+e._s(e.runHanding.createUserName)+" ")])]),t("li",[t("span",[e._v("上报时间")]),t("div",[e._v(e._s(e.runHanding.createTime))])]),t("li",[t("span",[e._v("事件类别")]),t("div",[e._v(e._s(e.runHanding.eventTypeName))])]),t("li",{staticClass:"ea"},[t("span",[e._v("事件地点")]),t("div",{staticClass:"ea_d"},[e._v(" "+e._s(e.runHanding.incidentAddress)+" "),e.runHanding.incidentAddress?t("span",{staticStyle:{color:"#01a6ff"},on:{click:function(t){return e.navigationFn(e.runHanding.incidentAddress,e.runHanding.x,e.runHanding.y)}}},[e._v("【点击导航】")]):e._e()])]),t("li",[t("span",[e._v("照片信息")]),t("div",{staticClass:"li_fileList"},e._l(e.runHanding.fileList,(function(a,n){return t("img",{key:n,attrs:{src:e.baseUrl+"rbac/file/downloadRb/"+a.fileId+"?rbacToken="+e.rbacToken_,alt:""},on:{click:function(t){return e.preview(a,e.runHanding.fileList)}}})})),0)])])]),t("div",{staticClass:"analyseClass"},[e._m(1),t("div",{staticClass:"form",class:e.edit?"":"unclick"},[t("div",{staticClass:"item"},[t("p",{class:e.formData.joinNum?"active":""},[e._v("人员数量")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.joinNum,expression:"formData.joinNum",modifiers:{trim:!0}}],attrs:{type:"number",placeholder:"在此输入人员数量",readonly:e.disabled},domProps:{value:e.formData.joinNum},on:{input:function(t){t.target.composing||e.$set(e.formData,"joinNum",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item"},[t("p",{class:e.formData.warningLevel?"active":""},[e._v("事件等级")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.warningLevelName,expression:"formData.warningLevelName",modifiers:{trim:!0}}],attrs:{type:"text",readonly:"",placeholder:"在此输入事件等级"},domProps:{value:e.formData.warningLevelName},on:{click:function(t){!e.disabled&&e.warningLevelFn()},input:function(t){t.target.composing||e.$set(e.formData,"warningLevelName",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item"},[t("p",{class:e.formData.warningLevel?"active":""},[e._v("现实行为")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.warningLevelName,expression:"formData.warningLevelName",modifiers:{trim:!0}}],attrs:{type:"text",readonly:"",placeholder:"在此选择现实行为"},domProps:{value:e.formData.warningLevelName},on:{click:function(t){!e.disabled&&e.warningLevelFn()},input:function(t){t.target.composing||e.$set(e.formData,"warningLevelName",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item"},[t("p",{class:e.planId?"active":""},[e._v("选择预案")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.planName,expression:"planName",modifiers:{trim:!0}}],attrs:{type:"text",readonly:"",placeholder:"在此选择应急预案"},domProps:{value:e.planName},on:{click:function(t){!e.disabled&&e.planIdFn()},input:function(t){t.target.composing||(e.planName=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item"},[t("p",{class:e.formData.incidentContent?"active":""},[e._v("事件描述")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.incidentContent,expression:"formData.incidentContent",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"在此输入事件描述",readonly:e.disabled},domProps:{value:e.formData.incidentContent},on:{input:function(t){t.target.composing||e.$set(e.formData,"incidentContent",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item"},[t("p",{class:e.formData.remark?"active":""},[e._v("备注")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.remark,expression:"formData.remark",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"在此输入备注",readonly:e.disabled},domProps:{value:e.formData.remark},on:{input:function(t){t.target.composing||e.$set(e.formData,"remark",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item"},[t("p",{staticClass:"active"},[e._v("研判人员")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.createUserName,expression:"formData.createUserName",modifiers:{trim:!0}}],attrs:{type:"text",readonly:"",placeholder:"在此输入研判人员"},domProps:{value:e.formData.createUserName},on:{input:function(t){t.target.composing||e.$set(e.formData,"createUserName",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item"},[t("p",{staticClass:"active"},[e._v("研判时间")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.createTime,expression:"formData.createTime",modifiers:{trim:!0}}],attrs:{type:"text",readonly:"",placeholder:"在此输入研判时间"},domProps:{value:e.formData.createTime},on:{input:function(t){t.target.composing||e.$set(e.formData,"createTime",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item",staticStyle:{"border-bottom":"none"}},[t("p",{staticClass:"active"},[e._v("研判地址")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.studyAddress,expression:"formData.studyAddress",modifiers:{trim:!0}}],attrs:{type:"text",readonly:"",placeholder:"在此输入研判地址"},domProps:{value:e.formData.studyAddress},on:{input:function(t){t.target.composing||e.$set(e.formData,"studyAddress",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})])])]),1!=e.type&&e.emergencyData.length?t("div",{staticClass:"emergency_c"},[e._m(2),t("div",{staticClass:"emergency_c_header"},[t("span",{class:e.emergencyStatus?"active_s":"",on:{click:function(t){return e.emergencyClick(!0)}}},[e._v("指挥室信息")]),t("span",{class:e.emergencyStatus?"":"active_s",on:{click:function(t){return e.emergencyClick(!1)}}},[e._v("已上报信息")])]),t("div",{staticClass:"emergency_c_content"},e._l(e.emergencyData,(function(a,n){return t("div",{key:n},[t("p",[e._v(e._s(a.progressTime))]),t("p",[e._v(e._s(a.progressContent))])])})),0)]):e._e(),3==e.type?t("div",{staticClass:"handleClass"},[e._m(3),e.detailData.processHandles?t("div",{staticClass:"handle_div"},e._l(e.detailData.processHandles,(function(a,n){return t("div",{key:n,style:n+1==e.detailData.processHandles.length?"border:none":""},[t("span",{staticClass:"handle_icon"}),t("div",{staticClass:"handle_div_t"},[e._v(e._s(a.createTime))]),t("div",{staticClass:"handle_div_t"},[e._v(e._s(a.handleMap.title))]),e._l(a.handleMap.contentList,(function(a,n){return t("div",{key:n},[e._v(" "+e._s(a)+" ")])})),a.handleMap.fileList?t("div",e._l(a.handleMap.fileList,(function(n,r){return t("img",{key:r,staticStyle:{width:"30%",height:"25vw",margin:"1vw"},attrs:{src:e.baseUrl+"rbac/file/downloadRb/"+n.fileId+"?rbacToken="+e.rbacToken_,alt:""},on:{click:function(t){return e.preview(n,a.handleMap.fileList)}}})})),0):e._e()],2)})),0):e._e()]):e._e(),1==e.type?t("div",{staticClass:"btn"},[t("span",{on:{click:function(t){return e.submitFn(1)}}},[e._v("启动预案")])]):e._e(),2==e.type?t("div",{staticClass:"btn"},[1==e.detailData.signStatus?t("span",{on:{click:function(t){return e.submitFn(3)}}},[e._v(" 上报 ")]):e._e(),2==e.detailData.signStatus?t("span",{on:{click:function(t){return e.changeSignStatusClick(3)}}},[e._v(" 确认 ")]):e._e(),2==e.detailData.signStatus?t("span",{on:{click:function(t){return e.changeSignStatusClick(4)}}},[e._v(" 无法执行 ")]):e._e(),3==e.detailData.signStatus?t("span",{on:{click:function(t){return e.changeSignStatusClick(1)}}},[e._v(" 签到 ")]):e._e(),4==e.detailData.signStatus?t("span",{staticStyle:{background:"gray"}},[e._v(" 无法执行 ")]):e._e()]):e._e()])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header_icon"},[t("span",[e._v("基本信息")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"header_icon"},[t("span",[e._v("分析研判")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"header_icon"},[t("span",[e._v("指挥调度")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"header_icon"},[t("span",[e._v("处置详情")])])}],i=(a("14d9"),a("c198")),s={data(){return{emergencyData:[],trueData:[],falseData:[],emergencyStatus:!0,rbacToken_:"",disabled:!1,edit:!0,eventData:[],levelData:[],planData:[],baseUrl:Object({NODE_ENV:"production",VUE_APP_ENV:"production",BASE_URL:""}).baseUrl,tabIndex:1,type:"",emergencyId:"",recordId:"",runHanding:{},detailData:{},formData:{joinNum:"",warningLevel:"",warningLevelName:"",eventType:"",eventTypeName:"",incidentContent:"",remark:"",createUserId:"",createUserName:"",createTime:"",studyAddress:"",studyLng:"",studyLat:"",isPlat:2},planId:"",planName:""}},async created(){const e=this;window.scrollTo(0,0),dd.disablePullToRefresh().then(e=>{}).catch(e=>{}),e.loadFn(),e.getDetail(),e.getSceneFeedBackListFn()},computed:{},methods:{async getSceneFeedBackListFn(){const e=this,t=await Object(i["yb"])({emergencyId:e.emergencyId});if(t.success){let a=[],n=[],r=t.data.feddBackList;r.map((e,t)=>{e.self?a.push(e):n.push(e)}),e.trueData=a,e.falseData=n,e.emergencyStatus?e.emergencyData=e.trueData:e.emergencyData=e.falseData}},changeSignStatusClick(e){const t=this;if(1==e){let e=t.M({lng1:t.formData.studyLng||0,lat1:t.formData.studyLat||0,lng2:t.runHanding.x||0,lat2:t.runHanding.y||0});if(e>500)return t.alert("超出打卡距离"),!1}dd.confirm({title:"温馨提示",message:"确定操作？",buttonLabels:["取消","确定"]}).then(async a=>{if(1==a.buttonIndex){const a=await Object(i["q"])({emergencyId:t.emergencyId,recordId:t.recordId,changeType:e});a.success&&dd.toast({icon:"success",text:"操作成功"}).then(e=>{t.getDetail()}).catch(e=>{})}}).catch(e=>{})},emergencyClick(e){const t=this;t.emergencyStatus=e,t.emergencyStatus?t.emergencyData=t.trueData:t.emergencyData=t.falseData},navigationFn(e,t,a){let n=["百度地图","高德地图"];t&&a?dd.getPhoneInfo().then(r=>{"Apple"==r.brand&&(n=["百度地图","高德地图","苹果地图"]),dd.showActionSheet({title:"",cancelButton:"取消",otherButtons:n}).then(n=>{let r="";0==n.buttonIndex&&(r="http://api.map.baidu.com/marker?output=html&src=webapp.baidu.openAPIdemo&title="+e+"&location="+a+","+t),1==n.buttonIndex&&(r="https://uri.amap.com/marker?src=mypage&callnative=1&name="+e+"&position="+t+","+a),2==n.buttonIndex&&(r="http://maps.apple.com/?address="+e),window.open(r)}).catch(e=>{})}):dd.toast({icon:"",text:"未获取到经纬度"}).then(e=>{}).catch(e=>{})},loadFn(){const e=this;let t=e.$route.query;t.emergencyId&&t.type?(localStorage.setItem("type",t.type),localStorage.setItem("emergencyId",t.emergencyId),e.emergencyId=t.emergencyId,e.type=t.type):(e.emergencyId=localStorage.getItem("emergencyId"),e.type=localStorage.getItem("type")),2==e.type||3==e.type?e.disabled=!0:e.disabled=!1;let a=e.$store.state;e.eventData=a.eventData,e.levelData=a.levelData,e.rbacToken_=e.$store.getters.rbacToken||localStorage.getItem("rbacToken"),localStorage.userInfo&&(e.formData.createUserId=JSON.parse(localStorage.userInfo).id,e.formData.createUserName=JSON.parse(localStorage.userInfo).name),e.formData.createTime=e.D(),dd.getGeolocation({targetAccuracy:200,coordinate:1,withReGeocode:!0,useCache:!1}).then(t=>{e.formData.studyAddress=t.address,e.formData.studyLng=t.longitude,e.formData.studyLat=t.latitude}).catch(e=>{})},planIdFn(){const e=this;let t=e.planData.map((e,t)=>({key:e.planName,value:e.id}));dd.showSelect({source:t}).then(async t=>{e.planId=t.value,e.planName=t.key}).catch(e=>{})},eventTypFn(){const e=this;dd.showSelect({source:e.eventData}).then(async t=>{e.formData.eventType=t.value,e.formData.eventTypeName=t.key;const a=await Object(i["hb"])({planType:e.formData.eventType});e.planData=a.data}).catch(e=>{})},warningLevelFn(){const e=this;dd.showSelect({source:e.levelData}).then(t=>{e.formData.warningLevel=t.value,e.formData.warningLevelName=t.key}).catch(e=>{})},preview(e,t){const a=this;if(e.fileType.indexOf("image")>=0){let n=[];t.map((e,t)=>{n.push(a.baseUrl+"rbac/file/downloadRb/"+e.fileId+"?rbacToken="+a.rbacToken_)}),dd.previewImage({current:a.baseUrl+"rbac/file/downloadRb/"+e.fileId+"?rbacToken="+a.rbacToken_,urls:n}).then(e=>{}).catch(e=>{})}else dd.biz.util.openLink({url:`${this.baseUrl}rbac/file/downloadRb/${e.fileId}?rbacToken=${localStorage.getItem("rbacToken")}`,onSuccess:function(e){},onFail:function(e){}})},async getDetail(){const e=this,t=await Object(i["R"])({emergencyId:e.emergencyId,type:e.type});e.detailData=t.data,e.recordId=e.detailData.recordId,e.runHanding=t.data.runHanding;let a=t.data.handingStudy;2!=e.type&&3!=e.type||(e.formData={joinNum:a.joinNum,warningLevel:a.warningLevel,warningLevelName:a.warningLevelName,eventType:a.eventType,eventTypeName:a.eventTypeName,incidentContent:a.incidentContent,remark:a.remark,createUserId:a.createUserId,createUserName:a.createUserName,createTime:a.createTime,studyAddress:a.studyAddress,studyLng:a.studyLng,studyLat:a.studyLat,isPlat:2},e.planName=e.runHanding.planName)},changeIndex(e){this.tabIndex!==e&&(window.scrollTo(0,0),this.tabIndex=e)},async submitFn(e){const t=this;if(1==e){const e=t.validateFn();if(e){let e={planId:t.planId,planName:t.planName,emergencyId:t.emergencyId,operationType:"101",handingStudy:t.formData};dd.confirm({title:"温馨提示",message:"确定提交？",buttonLabels:["取消","确定"]}).then(async a=>{if(1==a.buttonIndex){const a=await Object(i["y"])(e);a.success&&dd.toast({icon:"success",text:"操作成功"}).then(e=>{t.$router.go(-1)}).catch(e=>{})}}).catch(e=>{})}}2==e&&t.detailData.signStatus&&(3==t.detailData.signStatus?t.alert("已签到"):t.$router.push({path:"/ARuiAn/LinkageDisposal/signIn",query:{runTeamId:t.detailData.runTeamId,runStationId:t.detailData.runStationId,emergencyId:t.emergencyId,teamId:t.detailData.teamId,runProcessesTaskId:t.detailData.runProcessesTaskId}})),3==e&&t.$router.push({path:"/ARuiAn/LinkageDisposal/report",query:{runTeamId:t.detailData.runTeamId,runStationId:t.detailData.runStationId,emergencyId:t.emergencyId,teamId:t.detailData.teamId,runProcessesTaskId:t.detailData.runProcessesTaskId}})},validateFn(){const e=this;return e.formData.joinNum?e.formData.warningLevel?e.formData.incidentContent?e.formData.remark?!!e.planId||(e.alert("请输入流程名称"),!1):(e.alert("请输入备注"),!1):(e.alert("请输入事件描述"),!1):(e.alert("请输入事件等级"),!1):(e.alert("人员数量只能为数字并且不能为空"),!1)},alert(e){dd.alert({message:e,title:"提示",button:"收到"}).then(e=>{}).catch(e=>{})}}},c=s,o=(a("56a4"),a("2877")),l=Object(o["a"])(c,n,r,!1,null,"7c5a5f4a",null);t["default"]=l.exports},"8c8a":function(e,t,a){}}]);