(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08ae087c"],{7740:function(t,e,i){},"990c":function(t,e,i){"use strict";i.r(e);var c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"safetyAdd_warp"},[e("div",{staticClass:"form",class:t.edit?"":"unclick"},[e("div",{staticClass:"item"},[e("p",{class:t.formData.title?"active":""},[t._v("事件名称")]),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.formData.title,expression:"formData.title",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"在此输入事件名称"},domProps:{value:t.formData.title},on:{input:function(e){e.target.composing||t.$set(t.formData,"title",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"item"},[e("p",{class:t.formData.roadName?"active":""},[t._v("所属街道")]),e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.roadName,expression:"formData.roadName"}],attrs:{readonly:"",type:"text",placeholder:"点击选择所属街道"},domProps:{value:t.formData.roadName},on:{click:t.selectStreet,input:function(e){e.target.composing||t.$set(t.formData,"roadName",e.target.value)}}})])]),e("div",{staticClass:"item"},[e("p",{class:t.formData.incidentAddress?"active":""},[t._v("所属地点")]),e("div",{staticClass:"address"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.incidentAddress,expression:"formData.incidentAddress"}],attrs:{type:"text",placeholder:"点击选择所属地点"},domProps:{value:t.formData.incidentAddress},on:{input:function(e){e.target.composing||t.$set(t.formData,"incidentAddress",e.target.value)}}}),e("i",{staticClass:"iconfont icon-location",on:{click:t.selectAddress}})])]),e("div",{staticClass:"check"},[t._l(t.checkList,(function(i,c){return e("div",{key:c,class:t.checkIndex===c?"active":"",on:{click:function(e){return t.handCheck(c)}}},[e("span",[t._v("检查项"+t._s(c+1))]),t.checkList.length>1?e("i",{staticClass:"iconfont icon-cha2",on:{click:function(e){return t.delChack(c)}}}):t._e()])})),e("i",{staticClass:"iconfont icon-jia",on:{click:t.addCheck}})],2),e("div",{staticClass:"item"},[e("p",{class:t.checkList[t.checkIndex].firstName?"active":""},[t._v("检查项")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.checkList[t.checkIndex].firstName,expression:"checkList[checkIndex].firstName"}],attrs:{type:"text",readonly:"",placeholder:"请选择检查项"},domProps:{value:t.checkList[t.checkIndex].firstName},on:{click:t.selectFirst,input:function(e){e.target.composing||t.$set(t.checkList[t.checkIndex],"firstName",e.target.value)}}})]),e("div",{staticClass:"item"},[e("p",{class:t.checkList[t.checkIndex].secondName?"active":""},[t._v("所属类目")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.checkList[t.checkIndex].secondName,expression:"checkList[checkIndex].secondName"}],attrs:{type:"text",readonly:"",placeholder:"请选择所属类目"},domProps:{value:t.checkList[t.checkIndex].secondName},on:{click:t.selectSecond,input:function(e){e.target.composing||t.$set(t.checkList[t.checkIndex],"secondName",e.target.value)}}})]),e("div",{staticClass:"item question"},[e("div",{staticClass:"questionTitle"},[e("p",{class:"active"},[t._v("存在问题")]),e("i",{staticClass:"iconfont icon-jia",on:{click:t.addQues}})]),t._l(t.checkList[t.checkIndex].question,(function(i,c){return e("div",{key:c,staticClass:"questionList"},[e("div",[e("input",{attrs:{type:"text",readonly:"",placeholder:"请选择存在问题"},domProps:{value:i.name},on:{click:function(e){return t.selectThird(c)}}}),t.checkList[t.checkIndex].question.length>1?e("i",{staticClass:"iconfont icon-cha2",on:{click:function(e){return t.delQues(c)}}}):t._e()]),-1===t.checkList[t.checkIndex].question[c].id?e("div",{staticClass:"item"},[e("p",{staticClass:"active"},[t._v("问题描述")]),e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.checkList[t.checkIndex].question[c].otherContent,expression:"checkList[checkIndex].question[i].otherContent",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"请输入问题描述"},domProps:{value:t.checkList[t.checkIndex].question[c].otherContent},on:{input:function(e){e.target.composing||t.$set(t.checkList[t.checkIndex].question[c],"otherContent",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]):t._e()])}))],2),e("div",{staticClass:"item"},[e("p",{class:t.formData.aaa?"active":""},[t._v("附件上传")]),e("ul",{staticClass:"file"},t._l(t.files,(function(i,c){return e("li",{key:c},[e("span",[t._v(t._s(i.fileName))]),e("i",{staticClass:"iconfont icon-cha2",on:{click:function(e){return t.delFile(c)}}})])})),0),e("button",[t._v("上传"),e("input",{attrs:{multiple:"",type:"file",name:"",id:""},on:{change:t.fileChange}})])])]),e("div",{staticClass:"endHolder"}),e("div",{staticClass:"btn"},[t.id?t._e():e("span",{on:{click:function(e){return t.handClick(1)}}},[t._v("上报")]),e("i",{directives:[{name:"show",rawName:"v-show",value:!t.edit&&t.id,expression:"!edit&&id"}],on:{click:function(e){return t.del()}}},[t._v("删除")]),e("b",{directives:[{name:"show",rawName:"v-show",value:!t.edit&&t.id,expression:"!edit&&id"}],on:{click:function(e){t.edit=!0}}},[t._v("编辑")]),e("i",{directives:[{name:"show",rawName:"v-show",value:t.edit&&t.id,expression:"edit&&id"}],on:{click:t.cancel}},[t._v("取消")]),e("b",{directives:[{name:"show",rawName:"v-show",value:t.edit&&t.id,expression:"edit&&id"}],on:{click:t.handClick}},[t._v("保存")])])])},s=[],n=(i("14d9"),i("c198")),a={name:"reportedAdd",data(){return{id:this.$route.query.id,checkIndex:0,edit:!0,checkList:[{question:[{id:"",name:"",otherContent:""}],firstName:"",secondName:"",secondList:[],thirdList:[],secondOption:[],thirdOption:[]}],safety:[],formData:{id:this.$route.query.id,authName:"peaceIncident:permissionList",parentAuthName:"peaceIncident:permissionList",eventSafety:"",handleType:1,title:"",roadName:"",roadId:"",incidentAddress:"",incidentContent:"",incidentTime:"",earlyWarningName:"",joinNum:"",handleFilesListStr:""},files:[],firstList:[],firstOption:[]}},computed:{streetList(){return this.$store.state.common.streetList},streetOption(){return this.$store.state.common.streetList.map(t=>t.name)}},async created(){if(dd.ui.pullToRefresh.disable(),this.id){document.title="事件详情";const[t,e,i]=await Promise.all([Object(n["bb"])(this.$route.query),Object(n["ub"])({eventId:this.id}),Object(n["Bb"])({type:9})]);if(t.success){this.firstList=i.data,this.firstOption=i.data.map(t=>t.name),this.formData.roadName=t.data.sourceData.roadName,this.formData.roadId=t.data.sourceData.roadId,this.formData.title=t.data.sourceData.title,this.formData.incidentAddress=t.data.sourceData.incidentAddress;let c=0,s=0;e.data.forEach(t=>{t.page>c&&(this.checkList[t.page-1]={question:[],firstName:"",secondName:"",secondList:[],thirdList:[],secondOption:[],thirdOption:[]},c++,s=0),1===t.type&&(this.checkList[t.page-1].firstName=t.content,this.checkList[t.page-1].firstId=t.id,Object(n["Bb"])({type:9,parentId:t.id}).then(e=>{e.success&&(this.checkList[t.page-1].secondList=e.data,this.checkList[t.page-1].secondOption=e.data.map(t=>t.name))})),2===t.type&&(this.checkList[t.page-1].secondName=t.content,this.checkList[t.page-1].secondId=t.id,Object(n["Bb"])({type:9,parentId:t.id}).then(e=>{e.success&&(this.checkList[t.page-1].thirdList=e.data,this.checkList[t.page-1].thirdOption=e.data.map(t=>t.name))})),3===t.type&&(this.checkList[t.page-1].question.push({id:"",name:"",otherContent:""}),this.checkList[t.page-1].question[s].name=t.content,this.checkList[t.page-1].question[s].id=t.id,-1===t.id&&(this.checkList[t.page-1].question[s].otherContent=t.otherContent),s++)})}return}const t=await Object(n["Bb"])({type:9});t.success&&(this.firstList=t.data,this.firstOption=t.data.map(t=>t.name))},methods:{addCheck(){this.checkList.push({question:[{id:"",name:""}],firstName:"",secondName:""})},handCheck(t){this.checkIndex=t},delChack(t){this.checkList.splice(t,1)},addQues(){this.checkList[this.checkIndex].question.push({id:"",name:""})},delQues(t){this.checkList[this.checkIndex].question.splice(t,1)},selectFirst(){const t=this;dd.device.notification.actionSheet({title:"选择检查项",cancelButton:"取消",otherButtons:t.firstOption,async onSuccess(e){if(-1===e.buttonIndex)return;t.checkList[t.checkIndex].firstName=t.firstOption[e.buttonIndex],t.checkList[t.checkIndex].firstId=t.firstList[e.buttonIndex].id,t.checkList[t.checkIndex].secondName="",t.checkList[t.checkIndex].question=[{id:"",name:""}];const i=await Object(n["Bb"])({type:9,parentId:t.firstList[e.buttonIndex].id});i.success&&(t.checkList[t.checkIndex].secondList=i.data,t.checkList[t.checkIndex].secondOption=i.data.map(t=>t.name)),t.$forceUpdate()},onFail:function(t){}})},selectSecond(){const t=this;t.checkList[t.checkIndex].secondOption.length&&dd.device.notification.actionSheet({title:"选择所属类目",cancelButton:"取消",otherButtons:t.checkList[t.checkIndex].secondOption,async onSuccess(e){if(-1===e.buttonIndex)return;t.checkList[t.checkIndex].secondName=t.checkList[t.checkIndex].secondOption[e.buttonIndex],t.checkList[t.checkIndex].secondId=t.checkList[t.checkIndex].secondList[e.buttonIndex].id,t.checkList[t.checkIndex].question=[{id:"",name:""}];const i=await Object(n["Bb"])({type:9,parentId:t.checkList[t.checkIndex].secondList[e.buttonIndex].id});i.success&&(t.checkList[t.checkIndex].thirdList=[...i.data,{id:-1,name:"其他"}],t.checkList[t.checkIndex].thirdOption=i.data.map(t=>t.name),t.checkList[t.checkIndex].thirdOption.push("其他")),t.$forceUpdate()},onFail:function(t){}})},selectThird(t){const e=this;e.checkList[e.checkIndex].thirdOption.length&&dd.device.notification.actionSheet({title:"选择存在问题",cancelButton:"取消",otherButtons:e.checkList[e.checkIndex].thirdOption,async onSuccess(i){-1!==i.buttonIndex&&(e.checkList[e.checkIndex].question[t].name=e.checkList[e.checkIndex].thirdOption[i.buttonIndex],e.checkList[e.checkIndex].question[t].id=e.checkList[e.checkIndex].thirdList[i.buttonIndex].id,e.$forceUpdate())},onFail:function(t){}})},selectStreet(){const t=this;dd.device.notification.actionSheet({title:"选择所属街道？",cancelButton:"取消",otherButtons:t.streetOption,onSuccess:function(e){-1!==e.buttonIndex&&(t.formData.roadId=t.streetList[e.buttonIndex].id,t.formData.roadName=t.streetOption[e.buttonIndex])},onFail:function(t){}})},selectAddress(){const t=this;dd.biz.map.locate({onSuccess:function(e){var i=e.province+e.city+e.adName+e.snippet;t.formData.incidentAddress=i},onFail:function(t){alert(JSON.stringify(t))}})},del(){},cancel(){this.$router.go(-1)},save(){},handClick(t){if(!this.formData.title)return void this.alert("请输入事件名称");if(!this.formData.roadId)return void this.alert("请选择请选择所属街道");if(!this.formData.incidentAddress)return void this.alert("请输入所属地点");const e=this.id?n["Rb"]:n["o"];this.safety=[];let i=0,c=!1;if(this.checkList.forEach((t,e)=>{t.firstId&&(i++,this.safety.push({safetyTypeId:t.firstId,type:1,page:i}),this.safety.push({safetyTypeId:t.secondId,type:2,page:i}),t.question.forEach((t,e)=>{t.id&&(-1!==t.id||t.otherContent)&&(c=!0,this.safety.push({safetyTypeId:t.id,type:3,page:i,otherContent:t.otherContent}))}))}),!c)return void this.alert("请完成检查项选择");this.formData.eventSafety=JSON.stringify(this.safety),this.formData.handleFilesListStr=JSON.stringify(this.files);const s=this;dd.device.notification.confirm({message:this.id?"确定修改？":"确定上报？",title:"提示",buttonLabels:["取消","确定"],async onSuccess(t){if(t.buttonIndex){const t=await e(s.formData);t.success&&dd.device.notification.toast({text:"操作成功",duration:1.5,onSuccess(t){s.$router.go(-1)}})}},onFail:function(t){}})},async fileChange(t){let e=new FormData;const i=[...t.target.files];if(i&&i.length){dd.device.notification.showPreloader({text:"文件上传中..",showIcon:!0,onSuccess(t){}}),i.forEach(t=>{e.append("file",t)}),e.append("rbacToken",localStorage.getItem("rbacToken"));const t=await Object(n["gc"])(e);dd.device.notification.hidePreloader(),t.success&&t.data&&t.data.length&&t.data.forEach((t,e)=>{var c={};c.fileType=i[e].type,c.fileName=i[e].name,c.fileId=t,this.files.push(c)})}},delFile(t){this.files.splice(t,1)},alert(t){dd.device.notification.alert({message:t,title:"提示",buttonName:"确定"})}}},o=a,d=(i("c740"),i("2877")),r=Object(d["a"])(o,c,s,!1,null,"2eb6f533",null);e["default"]=r.exports},c740:function(t,e,i){"use strict";i("7740")}}]);