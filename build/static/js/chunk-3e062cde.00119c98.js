(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e062cde"],{"65c4":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"confirm_warp"},[e("h4",[t._v(t._s(t.title))]),"1"==t.i||"2"==t.i||"9"==t.i?e("div",{staticClass:"opinion"},[e("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.remark,expression:"remark",modifiers:{trim:!0}}],attrs:{name:"",id:"",placeholder:"请输入意见"},domProps:{value:t.remark},on:{input:function(e){e.target.composing||(t.remark=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),e("div",{staticClass:"accessory"},[e("span",[t._v("附件")]),e("b",[e("i",{staticClass:"iconfont icon-fujian"},[e("input",{attrs:{multiple:"",type:"file",name:"",id:""},on:{change:t.fileChange}})])])]),e("ul",{staticClass:"file"},t._l(t.files,(function(i,a){return e("li",{key:a},[e("span",[t._v(t._s(i.fileName))]),e("i",{staticClass:"iconfont icon-cha2",on:{click:function(e){return t.delFile(a)}}})])})),0)]):t._e(),"99"==t.i?e("div",{staticClass:"designate"},[e("div",{staticClass:"item"},[e("p",[t._v("检查人")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.checkPerson,expression:"formData.checkPerson"}],attrs:{type:"text",placeholder:"请输入检查人姓名"},domProps:{value:t.formData.checkPerson},on:{input:function(e){e.target.composing||t.$set(t.formData,"checkPerson",e.target.value)}}})]),e("div",{staticClass:"item"},[e("p",[t._v("整改情况说明")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.rectifyContent,expression:"formData.rectifyContent"}],attrs:{type:"text",placeholder:"请输入整改情况"},domProps:{value:t.formData.rectifyContent},on:{input:function(e){e.target.composing||t.$set(t.formData,"rectifyContent",e.target.value)}}})]),e("div",{staticClass:"item"},[e("p",[t._v("整改时间")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择整改时间"},domProps:{value:t.formData.checkDate},on:{click:t.selectCheckDate}})]),t._l(t.managementList,(function(i,a){return e("div",{key:a},[e("div",[t._v("问题"+t._s(a+1))]),e("div",[t._v(t._s(i.otherContent))]),e("div",{staticClass:"item"},[e("p",[t._v("整改情况")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.rectifyOption[t.formData.rectifyObj[a].rectifyStatus-1],expression:"rectifyOption[formData.rectifyObj[i].rectifyStatus - 1]"}],attrs:{type:"text",readonly:"",placeholder:"点击选择整改情况"},domProps:{value:t.rectifyOption[t.formData.rectifyObj[a].rectifyStatus-1]},on:{click:function(e){return t.selectRectifyStatus(a)},input:function(e){e.target.composing||t.$set(t.rectifyOption,t.formData.rectifyObj[a].rectifyStatus-1,e.target.value)}}})])])})),e("div",{staticClass:"item"},[e("p",{class:t.formData.aaa?"active":""},[t._v("附件上传")]),e("ul",{staticClass:"file"},t._l(t.files,(function(i,a){return e("li",{key:a},[e("span",[t._v(t._s(i.fileName))]),e("i",{staticClass:"iconfont icon-cha2",on:{click:function(e){return t.delFile(a)}}})])})),0),e("button",[t._v(" 上传"),e("input",{attrs:{multiple:"",type:"file",name:"",id:""},on:{change:t.fileChange}})])])],2):t._e(),"6"===t.i?e("div",{staticClass:"designate"},[e("div",{staticClass:"item"},[e("p",[t._v("截止时间")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择截止时间"},domProps:{value:t.formData.cutOffTime},on:{click:t.selectTime}})]),e("div",{staticClass:"item"},[e("p",[t._v("指派部门")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门"},domProps:{value:t.formData.deptName},on:{click:t.selectDept}}),t.formData.deptName?e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门人员"},domProps:{value:t.formData.userName.join()},on:{click:t.selectUser}}):t._e()]),e("div",{staticClass:"item"},[e("p",[t._v("协办部门")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门"},domProps:{value:t.formData.assistName.join()},on:{click:t.selectAssist}})]),e("div",{staticClass:"item"},[e("p",[t._v("报送领导")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择报送领导"},domProps:{value:t.formData.leaderName.join()},on:{click:t.selectLeader}})]),e("div",{staticClass:"item"},[e("p",[t._v("抄送人员")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择抄送人员"},domProps:{value:t.formData.copyUserName},on:{click:function(e){return t.copyDeptartClick(e)}}})]),e("div",{staticClass:"item"},[e("p",[t._v("处置要求")]),e("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.formData.remark,expression:"formData.remark",modifiers:{trim:!0}}],attrs:{name:"",id:"",placeholder:"请输入处置要求"},domProps:{value:t.formData.remark},on:{input:function(e){e.target.composing||t.$set(t.formData,"remark",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]):t._e(),"8"===t.i?e("div",{staticClass:"designate"},[e("div",{staticClass:"item"},[e("p",[t._v("协办部门")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门"},domProps:{value:t.formData.assistName.join()},on:{click:t.selectAssist}})]),e("div",{staticClass:"item"},[e("p",[t._v("报送领导")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择报送领导"},domProps:{value:t.formData.leaderName.join()},on:{click:t.selectLeader}})])]):t._e(),e("div",{staticClass:"endHolder"}),e("div",{staticClass:"btn"},[e("span",{on:{click:t.confirm}},[t._v("保存")])])])},s=[],o=(i("14d9"),i("c198")),n={data(){return{i:this.$route.query.i,id:this.$route.query.id,title:"",titles:["","处置情况","申请办结","","","","指派","","","办结"],opinion:"",deptList:[],deptOption:[],rectifyList:[{name:"未整改",id:1},{name:"整改中",id:2},{name:"已整改",id:3}],rectifyOption:["未整改","整改中","已整改"],userList:[],userOption:[],assistList:[],assistOption:[],leaderList:[],leaderOption:[],remark:"",managementList:"",formData:{remark:"",cutOffTime:"",deptName:"",userName:[],assistName:[],leaderName:[],leaderUserList:[],helpUserList:[],copyDeptartList:null,copyDeptartName:null,copyUserList:[],copyUserName:[],rectifyObj:[],checkPerson:"",rectifyContent:"",checkDate:""},files:[]}},async created(){dd.ui.pullToRefresh.disable(),this.title=this.titles[this.i];const[t,e,i]=await Promise.all([Object(o["Yb"])({isLeader:1}),Object(o["Yb"])({workgroupCodeId:"ZFWstab",workType:1}),Object(o["vb"])({eventId:this.id,teamworkType:3})]);1==i.success&&(this.managementList=i.data,this.managementList.forEach((t,e)=>{this.formData.rectifyObj.push(t),this.formData.rectifyObj[e].rectifyStatus=t.rectifyStatus})),t.success&&(this.deptList=e.data.departList,this.deptOption=e.data.departList.map(t=>t.name||"-"),e.data.departList.forEach(t=>{t.userList&&t.userList.length&&t.userList.forEach(e=>{e.departmentId=t.id,this.assistList.push(e),this.assistOption.push((t.name||"-")+":"+(e.name||"-"))})}),t.data.departList.forEach(t=>{t.userList&&t.userList.length&&t.userList.forEach(t=>{this.leaderList.push(t),this.leaderOption.push(t.name)})}))},methods:{confirm(){if(1==this.i||2==this.i||9==this.i||99==this.i){let t={rbacToken:localStorage.getItem("rbacToken"),remark:this.remark,eventId:this.id,handleType:this.$route.query.handleType,handleDepartmentId:this.$route.query.handleDepartmentId,operationType:4*this.i,authName:"emergencyHandleManagement:supplementaryExplanation",editDepartmentId:this.$route.query.handleDepartmentId,checkPerson:this.formData.checkPerson,rectifyContent:this.formData.rectifyContent,checkDate:this.formData.checkDate,problemList:this.formData.rectifyObj};if(9==this.i&&(t.operationType=5),99==this.i){let e=[];this.files.map((t,i)=>{e.push(t.fileId)}),t.files=e.join(",")}this.files.length?(t.isFile=1,t.handleFileListStr=JSON.stringify(this.files)):t.isFile=0;const e=this;return void dd.device.notification.confirm({message:"确定提交?",title:"提示",buttonLabels:["取消","确定"],onSuccess(i){1===i.buttonIndex&&dd.device.notification.showPreloader({text:"提交中..",showIcon:!0,async onSuccess(i){if(99==e.i){let i=await Object(o["Wb"])(t);dd.device.notification.hidePreloader({onSuccess:function(t){},onFail:function(t){}}),i.success&&dd.device.notification.toast({text:"操作成功",duration:1.5,onSuccess(t){e.$router.go(-2)}})}else{let i=await Object(o["l"])(t);dd.device.notification.hidePreloader({onSuccess:function(t){},onFail:function(t){}}),i.success&&dd.device.notification.toast({text:"操作成功",duration:1.5,onSuccess(t){"9"!==e.i?e.$router.go(-e.i):e.$router.go(-2)}})}},onFail:function(t){}})},onFail:function(t){}})}if(8==this.i){let t={dingLinkUrl:"https://pazht.ouhai.gov.cn:8000/fyDingtalkWeb/index.html#/listing/3",departmentId:this.$route.query.handleDepartmentId,eventId:this.id,editDepartmentId:this.$route.query.firstDepartmentId,operationType:2,helpUserList:this.formData.helpUserList,leaderUserList:this.formData.leaderUserList};const e=this;return void dd.device.notification.confirm({message:"是否确定新增处置?",title:"提示",buttonLabels:["取消","确定"],onSuccess(i){1===i.buttonIndex&&dd.device.notification.showPreloader({text:"处理中..",showIcon:!0,async onSuccess(i){const a=await Object(o["k"])(t);dd.device.notification.hidePreloader({onSuccess:function(t){},onFail:function(t){}}),a.success&&dd.device.notification.toast({text:"操作成功",duration:1.5,onSuccess(t){e.$router.go(-1)}})},onFail:function(t){}})},onFail:function(t){}})}if(!this.formData.userName.length)return void this.alert("请指派部门及人员");const t=this;t.formData.operationType=3,t.formData.eventId=this.id,t.formData.handleDepartmentId=this.$route.query.handleDepartmentId,t.formData.dingLinkUrl="https://pazht.ouhai.gov.cn:8000/fyDingtalkWeb/index.html#/listing/3",dd.device.notification.confirm({message:"确定指派？",title:"提示",buttonLabels:["取消","确定"],async onSuccess(e){e.buttonIndex&&dd.device.notification.showPreloader({text:"指派中..",showIcon:!0,async onSuccess(e){let i=Object.assign({},t.formData,{remark:null});const a=await Object(o["k"])(i);if(a.success){await Object(o["k"])({departmentId:"8d406cedc99448b3a68b7033a92487be",eventId:t.id,handleType:1,operationType:4,remark:t.formData.remark});dd.device.notification.hidePreloader({onSuccess:function(t){},onFail:function(t){}})}else dd.device.notification.hidePreloader({onSuccess:function(t){},onFail:function(t){}});a.success&&dd.device.notification.toast({icon:"",text:"指派成功",duration:2,delay:0,onSuccess(e){t.$router.go(-2)},onFail:function(t){}})},onFail:function(t){}})},onFail:function(t){}})},async fileChange(t){let e=new FormData;const i=[...t.target.files];if(i&&i.length){dd.device.notification.showPreloader({text:"文件上传中..",showIcon:!0,onSuccess(t){}}),i.forEach(t=>{e.append("file",t)}),e.append("rbacToken",localStorage.getItem("rbacToken"));const t=await Object(o["gc"])(e);t.success&&(dd.device.notification.hidePreloader({onSuccess:function(t){},onFail:function(t){}}),t.data&&t.data.length&&t.data.forEach((t,e)=>{var a={};a.fileType=i[e].type,a.fileName=i[e].name,a.fileId=t,this.files.push(a)}))}},delFile(t){this.files.splice(t,1)},selectTime(){const t=this,e=new Date,i=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,0)}-${String(e.getDate()).padStart(2,0)}`;dd.biz.util.datepicker({start:i,format:"yyyy-MM-dd",value:t.formData.cutOffTime,onSuccess:function(e){t.formData.cutOffTime=e.value},onFail:function(t){}})},selectCheckDate(){const t=this,e=new Date,i=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,0)}-${String(e.getDate()).padStart(2,0)}`;dd.biz.util.datepicker({start:i,format:"yyyy-MM-dd",value:t.formData.checkDate,onSuccess:function(e){t.formData.checkDate=e.value},onFail:function(t){}})},selectDept(){const t=this;dd.device.notification.actionSheet({title:"选择指派部门？",cancelButton:"取消",otherButtons:t.deptOption,onSuccess:function(e){-1!==e.buttonIndex&&(t.formData.userName=[],t.formData.operationId=t.deptList[e.buttonIndex].id,t.formData.departmentId=t.deptList[e.buttonIndex].id,t.formData.deptName=t.deptOption[e.buttonIndex],t.userList=t.deptList[e.buttonIndex].userList,t.userOption=t.userList.map(t=>t.name))},onFail:function(t){}})},selectRectifyStatus(t){const e=this;dd.device.notification.actionSheet({title:"选择整改情况？",cancelButton:"取消",otherButtons:e.rectifyOption,onSuccess:function(i){-1!==i.buttonIndex&&(e.formData.rectifyObj[t].rectifyStatus=e.rectifyList[i.buttonIndex].id)},onFail:function(t){}})},selectUser(){const t=this;dd.biz.util.multiSelect({options:t.userOption,selectOption:t.formData.userName,onSuccess:function(e){-1!==e.buttonIndex&&(t.formData.mainUserList=[],t.formData.userName=e.map(e=>(t.formData.mainUserList.push(t.userList[e]),t.userOption[e])))},onFail:function(){}})},copyDeptartClick(){const t=this;dd.biz.util.multiSelect({options:t.assistOption,selectOption:t.formData.copyUserName,onSuccess(e){-1!==e.buttonIndex&&(t.formData.copyUserList=[],t.formData.copyUserName=e.map(e=>(t.formData.copyUserList.push(t.assistList[e]),t.assistOption[e])))},onFail:function(){}})},selectAssist(){const t=this;dd.biz.util.multiSelect({options:t.assistOption,selectOption:t.formData.assistName,onSuccess(e){-1!==e.buttonIndex&&(t.formData.helpUserList=[],t.formData.assistName=e.map(e=>(t.formData.helpUserList.push(t.assistList[e]),t.assistOption[e])))},onFail:function(){}})},selectLeader(){const t=this;dd.biz.util.multiSelect({options:t.leaderOption,selectOption:t.formData.leaderName,onSuccess(e){-1!==e.buttonIndex&&(t.formData.leaderUserList=[],t.formData.leaderName=e.map(e=>(t.formData.leaderUserList.push(t.leaderList[e]),t.leaderOption[e])))},onFail:function(){}})},alert(t){dd.device.notification.alert({message:t,title:"提示",buttonName:"确定"})}}},r=n,c=(i("9b99"),i("2877")),l=Object(c["a"])(r,a,s,!1,null,"17f244b0",null);e["default"]=l.exports},"9b99":function(t,e,i){"use strict";i("dcf5")},dcf5:function(t,e,i){}}]);