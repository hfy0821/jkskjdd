(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d870adc"],{"0800":function(t,e,i){"use strict";i("ee43")},"2ba5":function(t,e,i){},ae99:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"confirm_warp"},[e("h4",[t._v(t._s(t.title))]),"1"===t.i||"2"===t.i||"9"===t.i?e("div",{staticClass:"opinion"},[e("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.remark,expression:"remark",modifiers:{trim:!0}}],attrs:{name:"",id:"",placeholder:"请输入意见"},domProps:{value:t.remark},on:{input:function(e){e.target.composing||(t.remark=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),e("div",{staticClass:"accessory"},[e("span",[t._v("附件")]),e("b",[e("i",{staticClass:"iconfont icon-fujian"},[e("input",{attrs:{multiple:"",type:"file",name:"",id:""},on:{change:t.fileChange}})])])]),e("ul",{staticClass:"file"},t._l(t.files,(function(i,a){return e("li",{key:a},[e("span",[t._v(t._s(i.fileName))]),e("i",{staticClass:"iconfont icon-cha2",on:{click:function(e){return t.delFile(a)}}})])})),0)]):t._e(),"6"===t.i?e("div",{staticClass:"designate"},[e("div",{staticClass:"item"},[e("p",[t._v("截止时间")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择截止时间"},domProps:{value:t.formData.cutOffTime},on:{click:t.selectTime}})]),e("div",{staticClass:"item"},[e("p",[t._v("指派部门")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门"},domProps:{value:t.formData.deptName},on:{click:t.selectDept}}),t.formData.deptName?e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门人员"},domProps:{value:t.formData.userName.join()},on:{click:t.selectUser}}):t._e()]),e("div",{staticClass:"item"},[e("p",[t._v("协办部门")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门"},domProps:{value:t.formData.assistName.join()},on:{click:t.selectAssist}})]),e("div",{staticClass:"item"},[e("p",[t._v("报送领导")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择报送领导"},domProps:{value:t.formData.leaderName.join()},on:{click:t.selectLeader}})]),e("div",{staticClass:"item"},[e("p",[t._v("处置要求")]),e("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.formData.remark,expression:"formData.remark",modifiers:{trim:!0}}],attrs:{name:"",id:"",placeholder:"请输入处置要求"},domProps:{value:t.formData.remark},on:{input:function(e){e.target.composing||t.$set(t.formData,"remark",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]):t._e(),"8"===t.i?e("div",{staticClass:"designate"},[e("div",{staticClass:"item"},[e("p",[t._v("协办部门")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择部门"},domProps:{value:t.formData.assistName.join()},on:{click:t.selectAssist}})]),e("div",{staticClass:"item"},[e("p",[t._v("报送领导")]),e("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择报送领导"},domProps:{value:t.formData.leaderName.join()},on:{click:t.selectLeader}})])]):t._e(),e("div",{staticClass:"endHolder"}),e("div",{staticClass:"btn"},[e("span",{on:{click:t.confirm}},[t._v("确认")])]),e("van-popup",{model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[e("div",{staticClass:"assist"},[e("h6",[t._v("请选择")]),e("mt-checklist",{attrs:{title:"复选框列表",options:t.assistOption},model:{value:t.formData.assistName,callback:function(e){t.$set(t.formData,"assistName",e)},expression:"formData.assistName"}})],1)])],1)},s=[],o=(i("14d9"),i("c198")),n={data(){return{i:this.$route.query.i,id:this.$route.query.id,title:"",titles:["","处置情况","申请办结","","","","指派","","","办结"],opinion:"",deptList:[],deptOption:[],userList:[],userOption:[],assistList:[],myAssistList:[],assistOption:[],leaderList:[],leaderOption:[],remark:"",formData:{remark:"",cutOffTime:"",deptName:"",userName:[],assistName:[],leaderName:[],leaderUserList:[],helpUserList:[]},files:[],show:!1}},async created(){dd.ui.pullToRefresh.disable(),this.title=this.titles[this.i];const[t,e]=await Promise.all([Object(o["Yb"])({isLeader:1}),Object(o["Yb"])({workgroupCodeId:"ZFWstab",workType:1})]);t.success&&(this.deptList=e.data.departList,this.deptOption=e.data.departList.map(t=>t.name||"-"),e.data.departList.forEach(t=>{t.userList&&t.userList.length&&t.userList.forEach(e=>{e.departmentId=t.id,this.assistList.push(e),this.myAssistList.push({name:(t.name||"-")+":"+(e.name||"-")}),this.assistOption.push((t.name||"-")+":"+(e.name||"-"))})}),t.data.departList.forEach(t=>{t.userList&&t.userList.length&&t.userList.forEach(t=>{this.leaderList.push(t),this.leaderOption.push(t.name)})}))},methods:{confirm(){if(1==this.i||2==this.i||9==this.i){let t={rbacToken:localStorage.getItem("rbacToken"),remark:this.remark,eventId:this.id,handleType:this.$route.query.handleType,handleDepartmentId:this.$route.query.handleDepartmentId,operationType:4*this.i,authName:"emergencyHandleManagement:supplementaryExplanation",editDepartmentId:this.$route.query.handleDepartmentId};9==this.i&&(t.operationType=5),this.files.length?(t.isFile=1,t.handleFileListStr=JSON.stringify(this.files)):t.isFile=0;const e=this;return void dd.device.notification.confirm({message:"确定提交?",title:"提示",buttonLabels:["取消","确定"],onSuccess(i){1===i.buttonIndex&&dd.device.notification.showPreloader({text:"提交中..",showIcon:!0,async onSuccess(i){const a=await Object(o["l"])(t);dd.device.notification.hidePreloader(),a.success&&dd.device.notification.toast({text:"操作成功",duration:1.5,onSuccess(t){"9"!==e.i?e.$router.go(-e.i):e.$router.go(-2)}})},onFail:function(t){}})},onFail:function(t){}})}if(8==this.i){let t={dingLinkUrl:"https://pazht.ouhai.gov.cn:8000/fyDingtalkWeb/index.html#/listing/3",departmentId:this.$route.query.handleDepartmentId,eventId:this.id,editDepartmentId:this.$route.query.firstDepartmentId,operationType:2,helpUserList:this.formData.helpUserList,leaderUserList:this.formData.leaderUserList};const e=this;return void dd.device.notification.confirm({message:"是否确定新增处置?",title:"提示",buttonLabels:["取消","确定"],onSuccess(i){1===i.buttonIndex&&dd.device.notification.showPreloader({text:"处理中..",showIcon:!0,async onSuccess(i){const a=await Object(o["k"])(t);dd.device.notification.hidePreloader(),a.success&&dd.device.notification.toast({text:"操作成功",duration:1.5,onSuccess(t){e.$router.go(-1)}})},onFail:function(t){}})},onFail:function(t){}})}if(!this.formData.userName.length)return void this.alert("请指派部门及人员");const t=this;t.formData.operationType=3,t.formData.eventId=this.id,t.formData.handleDepartmentId=this.$route.query.handleDepartmentId,t.formData.dingLinkUrl="https://pazht.ouhai.gov.cn:8000/fyDingtalkWeb/index.html#/listing/3",dd.device.notification.confirm({message:"确定指派？",title:"提示",buttonLabels:["取消","确定"],async onSuccess(e){e.buttonIndex&&dd.device.notification.showPreloader({text:"指派中..",showIcon:!0,async onSuccess(e){const i=await Object(o["k"])(t.formData);if(i.success){await Object(o["k"])({departmentId:"8d406cedc99448b3a68b7033a92487be",eventId:t.id,handleType:1,operationType:4,remark:t.formData.remark});dd.device.notification.hidePreloader()}else dd.device.notification.hidePreloader();i.success&&dd.device.notification.toast({icon:"",text:"指派成功",duration:2,delay:0,onSuccess(e){t.$router.go(-2)},onFail:function(t){}})},onFail:function(t){}})},onFail:function(t){}})},async fileChange(t){let e=new FormData;const i=[...t.target.files];if(i&&i.length){dd.device.notification.showPreloader({text:"文件上传中..",showIcon:!0,onSuccess(t){}}),i.forEach(t=>{e.append("file",t)}),e.append("rbacToken",localStorage.getItem("rbacToken"));const t=await Object(o["gc"])(e);dd.device.notification.hidePreloader(),t.success&&t.data&&t.data.length&&t.data.forEach((t,e)=>{var a={};a.fileType=i[e].type,a.fileName=i[e].name,a.fileId=t,this.files.push(a)})}},delFile(t){this.files.splice(t,1)},selectTime(){const t=this,e=new Date,i=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,0)}-${String(e.getDate()).padStart(2,0)}`;dd.biz.util.datepicker({start:i,format:"yyyy-MM-dd",value:t.formData.incidentTime,onSuccess:function(e){t.formData.cutOffTime=e.value},onFail:function(t){}})},selectDept(){const t=this;dd.device.notification.actionSheet({title:"选择指派部门？",cancelButton:"取消",otherButtons:t.deptOption,onSuccess:function(e){-1!==e.buttonIndex&&(t.formData.userName=[],t.formData.operationId=t.deptList[e.buttonIndex].id,t.formData.departmentId=t.deptList[e.buttonIndex].id,t.formData.deptName=t.deptOption[e.buttonIndex],t.userList=t.deptList[e.buttonIndex].userList,t.userOption=t.userList.map(t=>t.name))},onFail:function(t){}})},selectUser(){const t=this;dd.biz.util.multiSelect({options:t.userOption,selectOption:t.formData.userName,onSuccess:function(e){-1!==e.buttonIndex&&(t.formData.mainUserList=[],t.formData.userName=e.map(e=>(t.formData.mainUserList.push(t.userList[e]),t.userOption[e])))},onFail:function(){}})},selectAssist(){const t=this;dd.biz.util.multiSelect({options:t.assistOption,selectOption:t.formData.assistName,onSuccess(e){-1!==e.buttonIndex&&(t.formData.helpUserList=[],t.formData.assistName=e.map(e=>(t.formData.helpUserList.push(t.assistList[e]),t.assistOption[e])))},onFail:function(){}})},selectLeader(){const t=this;dd.biz.util.multiSelect({options:t.leaderOption,selectOption:t.formData.leaderName,onSuccess(e){-1!==e.buttonIndex&&(t.formData.leaderUserList=[],t.formData.leaderName=e.map(e=>(t.formData.leaderUserList.push(t.leaderList[e]),t.leaderOption[e])))},onFail:function(){}})},alert(t){dd.device.notification.alert({message:t,title:"提示",buttonName:"确定"})}}},r=n,d=(i("e165"),i("0800"),i("2877")),c=Object(d["a"])(r,a,s,!1,null,"e9447a5a",null);e["default"]=c.exports},e165:function(t,e,i){"use strict";i("2ba5")},ee43:function(t,e,i){}}]);