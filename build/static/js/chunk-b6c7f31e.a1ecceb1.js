(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b6c7f31e"],{6558:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"event_warp"},[t("div",{staticClass:"tab"},[t("Nav",{attrs:{tabs:e.tabs,tabIndex:e.tabIndex},on:{changeIndex:e.changeIndex}})],1),t("div",{staticClass:"topHolder"}),t("div",{staticClass:"subTab"}),t("div",{directives:[{name:"show",rawName:"v-show",value:1===e.tabIndex,expression:"tabIndex === 1"}],staticClass:"detailMsg"},[t("ul",{staticClass:"ul"},[e.checkRight("emergencyHandleManagement:eventName","emergencyEventManagement:eventName","emergencyDistributionManagement:eventName")?t("li",{staticClass:"li"},[t("span",[e._v("事件名称")]),t("div",[e._v(e._s(e.detail.title))])]):e._e(),e.checkRight("emergencyHandleManagement:location","emergencyEventManagement:location","emergencyDistributionManagement:location")?t("li",[t("span",[e._v("事发地址")]),t("div",[e._v(e._s(e.detail.incidentAddress))])]):e._e(),e.checkRight("emergencyHandleManagement:eventDescription","emergencyEventManagement:eventDescription","emergencyDistributionManagement:eventDescription")?t("li",[t("span",[e._v("事件描述")]),t("div",[e._v(e._s(e.detail.incidentContent))])]):e._e(),e.checkRight("emergencyHandleManagement:eventCategory","emergencyEventManagement:eventCategory","emergencyDistributionManagement:eventCategory")?t("li",[t("span",[e._v("事件类别")]),t("div",[e._v(" "+e._s(e.detail.eventName&&e.detail.eventName.length&&e.detail.eventName.join())+" ")])]):e._e(),e.checkRight("emergencyHandleManagement:eventSource","emergencyEventManagement:eventSource","emergencyDistributionManagement:eventSource")?t("li",[t("span",[e._v("事件来源")]),t("div",[e._v("涉稳事件录入")])]):e._e(),e.checkRight("emergencyHandleManagement:area","emergencyEventManagement:area","emergencyDistributionManagement:area")?t("li",[t("span",[e._v("所属区域")]),t("div",[e._v("瓯海区")])]):e._e(),e.checkRight("emergencyHandleManagement:affiliatedStreet","emergencyEventManagement:affiliatedStreet","emergencyDistributionManagement:affiliatedStreet")?t("li",[t("span",[e._v("所属街道")]),t("div",[e._v(e._s(e.detail.roadName))])]):e._e(),t("li",[t("span",[e._v("事发时间")]),t("div",[e._v(e._s(e.detail.incidentTime))])]),t("li",[t("span",[e._v("截止时间")]),t("div",[e._v(e._s(e.detail.cutOffTime))])]),t("li",[t("span",[e._v("最新处置时间")]),t("div",[e._v(e._s(e.detail.updateTime))])])])]),2===e.tabIndex?t("div",{staticClass:"schedule"},[t("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMore,expression:"loadMore"}],staticClass:"list",attrs:{"infinite-scroll-disabled":e.loading&&2===e.tabIndex,"infinite-scroll-distance":"10"}},e._l(e.handleList,(function(n,i){return t("li",{key:i},[t("div",[t("div",{staticClass:"title"},[e._v(e._s(i+1))]),t("i",[e._v(e._s(n.createTime))])]),t("div",[t("span",[e._v("处理阶段")]),t("div",[e._v(e._s(n.step))])]),t("div",[t("span",[e._v("创建人")]),t("div",[e._v(e._s(n.userName))])]),t("div",[t("span",[e._v("签收时间")]),t("div",[e._v(e._s(n.signTime))])])])})),0)]):e._e(),3===e.tabIndex?t("div",{staticClass:"accessory"},[t("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMore,expression:"loadMore"}],staticClass:"list",attrs:{"infinite-scroll-disabled":e.loading&&3===e.tabIndex,"infinite-scroll-distance":"10"}},e._l(e.fileList,(function(n,i){return t("li",{key:i},[t("div",[t("div",{staticClass:"title"},[e._v(e._s(i+1))]),t("i",[e._v(e._s(n.createTime))])]),t("div",[t("span",[e._v("附件信息")]),t("div",[t("p",{on:{click:function(t){return e.preview(n)}}},[e._v(e._s(n.fileName))])])]),e._m(0,!0)])})),0)]):e._e(),4===e.tabIndex?t("div",{staticClass:"disposition"},[t("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMore,expression:"loadMore"}],staticClass:"list",attrs:{"infinite-scroll-disabled":e.loading&&4===e.tabIndex,"infinite-scroll-distance":"10"}},e._l(e.supplementHandleList,(function(n,i){return t("li",{key:i},[t("div",[t("div",{staticClass:"title"},[e._v(e._s(i+1))]),t("i",[e._v(e._s(n.createTime))])]),t("div",[t("span",[e._v("处置情况")]),t("div",[e._v(e._s(n.remark))])]),t("div",[t("span",[e._v("上传人")]),t("div",[e._v(e._s(n.userName))])])])})),0)]):e._e(),5===e.tabIndex?t("div",{staticClass:"instructions"},[t("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMore,expression:"loadMore"}],staticClass:"list",attrs:{"infinite-scroll-disabled":e.loading&&5===e.tabIndex,"infinite-scroll-distance":"10"}},e._l(e.leaderHandleList,(function(n,i){return t("li",{key:i},[t("div",[t("div",{staticClass:"title"},[e._v(e._s(i+1))]),t("i",[e._v(e._s(n.createTime))])]),t("div",[t("span",[e._v("领导批示")]),t("div",[e._v(e._s(n.remark||"无"))])]),t("div",[t("span",[e._v("姓名")]),t("div",[e._v(e._s(n.optUserName))])])])})),0)]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showImg,expression:"showImg"}],staticClass:"preview",on:{click:function(t){e.showImg=!1}}},[t("img",{attrs:{src:e.previewUrl,alt:""}})]),t("div",{staticClass:"endHolder"}),1==e.type?t("div",{staticClass:"btn"},[e.checkRight("emergencyHandleManagement:supplementaryExplanation")?t("span",{on:{click:function(t){return e.handClick(1)}}},[e._v("处置情况")]):e._e(),e.checkRight("emergencyHandleManagement:applyForKnot")?t("span",{on:{click:function(t){return e.handClick(2)}}},[e._v("申请办结")]):e._e()]):e._e(),2==e.type?t("div",{staticClass:"btn assist"},[e.checkRight("emergencyHandleManagement:supplementaryExplanation")?t("span",{on:{click:function(t){return e.handClick(1)}}},[e._v("处置情况")]):e._e()]):e._e(),3==e.type?t("div",{staticClass:"btn"},[e.checkRight("emergencyEventManagement:processingEdit")?t("span",{on:{click:function(t){return e.handClick(3)}}},[e._v("编辑")]):e._e(),e.checkRight("emergencyEventManagement:processingWithdraw")?t("span",{on:{click:function(t){return e.handClick(4)}}},[e._v("撤回")]):e._e(),e.checkRight("emergencyEventManagement:processingEdit")?t("span",{on:{click:function(t){return e.handClick(8)}}},[e._v("新增处置")]):e._e(),e.checkRight("emergencyEventManagement:processingSupplementaryExplanation")?t("span",{on:{click:function(t){return e.handClick(1)}}},[e._v("处置情况")]):e._e()]):e._e(),4==e.type?t("div",{staticClass:"btn"},[e.checkRight("emergencyEventManagement:processingEdit")?t("span",{on:{click:function(t){return e.handClick(3)}}},[e._v("编辑")]):e._e(),e.checkRight("emergencyEventManagement:repliedWithdraw")?t("span",{on:{click:function(t){return e.handClick(5)}}},[e._v("退回")]):e._e(),e.checkRight("emergencyEventManagement:processingSupplementaryExplanation")?t("span",{on:{click:function(t){return e.handClick(1)}}},[e._v("处置情况")]):e._e(),e.checkRight("emergencyEventManagement:repliedSetUp")?t("span",{on:{click:function(t){return e.handClick(9)}}},[e._v("办结")]):e._e()]):e._e(),6==e.type?t("div",{staticClass:"btn"},[e.checkRight("emergencyDistributionManagement:assign")?t("span",{on:{click:function(t){return e.handClick(6)}}},[e._v("指派")]):e._e(),e.checkRight("emergencyDistributionManagement:edit")?t("span",{on:{click:function(t){return e.handClick(3)}}},[e._v("编辑")]):e._e(),e.checkRight("emergencyDistributionManagement:delete")?t("span",{on:{click:function(t){return e.handClick(7)}}},[e._v("删除")]):e._e()]):e._e()])},a=[function(){var e=this,t=e._self._c;return t("div",[t("span",[e._v("上传人")]),t("div",[e._v("111")])])}],s=(n("14d9"),n("9fdc")),c=n("c198"),r={name:"detail",components:{Nav:s["a"]},data(){return{showImg:!1,previewUrl:"",baseUrl:Object({NODE_ENV:"production",VUE_APP_ENV:"production",BASE_URL:""}).baseUrl,loading:!1,noMore:[!1,!1,!1,!1,!1,!1],tabs:[],tabIndex:1,type:this.$route.query.type,id:this.$route.query.id,supplementHandleList:[],detail:{},right:"",handleList:[],fileList:[],leaderHandleList:[],signData:{}}},async created(){const e=this;dd.enablePullToRefresh().then(t=>{e.getDetail(),e.getMore(),e.getHandleRole()}).catch(e=>{dd.stopPullDownRefresh()}),this.getDetail(),this.getMore(),this.getHandleRole()},methods:{preview(e){e.fileType.indexOf("image")>=0?(this.showImg=!0,this.previewUrl=`${this.baseUrl}rbac/file/downloadRb/${e.fileId}?rbacToken=${localStorage.getItem("rbacToken")}`):dd.biz.util.openLink({url:`${this.baseUrl}rbac/file/downloadRb/${e.fileId}?rbacToken=${localStorage.getItem("rbacToken")}`,onSuccess:function(e){},onFail:function(e){}})},async getHandleRole(){if("1"===this.type||"2"===this.type||"4"===this.type){const e=await Object(c["db"])({eventId:this.id,isSign:0,eventType:1});if(e.success)if(e.data.length>0&&20!=e.data[0].operationType){if(this.signData=e.data[0],0==this.signData.isSign){const e=await Object(c["Vb"])({id:this.signData.id});e.success}}else this.signData={isSign:1}}},async getDetail(){const e=await Object(c["bb"])(this.$route.query);if(e.success){this.detail=e.data.sourceData;const t=[...e.data.barRight||[],...e.data.bottomRight||[],...e.data.filedRight||[]];if(t.length&&t.forEach(e=>{this.right+=e.name}),1==this.type||2==this.type||5==this.type)return void(this.tabs=[{name:"详细信息"},{name:"事件进度",hide:!this.checkRight("emergencyHandleManagement:processing")},{name:"附件信息",hide:!this.checkRight("emergencyHandleManagement:extInfo")},{name:"处置情况",hide:!this.checkRight("emergencyHandleManagement:resultInfo")},{name:"领导批示",hide:!this.checkRight("emergencyHandleManagement:leadershipInstructions")}]);if(3==this.type||4==this.type)return void(this.tabs=[{name:"详细信息"},{name:"事件进度",hide:!this.checkRight("emergencyEventManagement:processing")},{name:"附件信息",hide:!this.checkRight("emergencyEventManagement:extInfo")},{name:"处置情况",hide:!this.checkRight("emergencyEventManagement:resultInfo")},{name:"领导批示",hide:!this.checkRight("emergencyEventManagement:leadershipInstructions")}]);this.tabs=[{name:"详细信息"},{name:"事件进度",hide:!this.checkRight("emergencyDistributionManagement:progress")},{name:"附件信息",hide:!this.checkRight("emergencyDistributionManagement:extInfo")},{name:"处置情况",hide:!this.checkRight("emergencyDistributionManagement:resultInfo")},{name:"领导批示",hide:1}]}},async getMore(){const e={eventId:this.id},[t,n,i,a]=await Promise.all([Object(c["cb"])(e),Object(c["ac"])(e),Object(c["fb"])({eventId:this.id,operationType:21}),Object(c["Cb"])({eventType:-1,orderType:1,eventId:this.id})]);if(t.success){this.fileList=n.data,this.leaderHandleList=i.data,this.supplementHandleList=a.data;const e=t.data;this.handleList=[],e.length&&e.forEach(e=>{var t="";switch(e.editDepartment&&(t+=e.editDepartment),t+=e.userName,e.operationType){case 0:e.step=t+"将事件转入协同处置系统";break;case 1:e.step=t+"将事件批转给"+e.department;break;case 2:e.step=t+"将"+e.department+"加入协办";break;case 3:e.step=t+"将事件指派给"+e.department;break;case 4:e.step=e.editDepartment+"添加补充说明";break;case 5:e.step=t+"办结了该事件";break;case 6:e.step=t+"上报该事件到协同处置系统";break;case 7:e.step=t+"上报区级";break;case 8:e.step=t+"申请办结";break;case 9:e.step=t+"将事件撤回";break;case 10:e.step=t+"将事件退回给"+e.department;break;case 22:e.step=t+"将事件抄送给"+e.department;break}this.handleList.push(e),5!=e.operationType&&e.recordList&&e.recordList.forEach(t=>{var n={};n.step=e.department+"处理人员:"+t.userName,n.createTime=e.createTime,n.userName=e.userName,n.isSign=t.isSign,n.signTime=t.signTime,this.handleList.push(n)})}),dd.stopPullDownRefresh()}},changeIndex(e){this.tabIndex!==e&&(window.scrollTo(0,0),this.tabIndex=e)},loadMore(){},handClick(e){if(1!==e&&2!==e&&9!==e)if(3!==e)if(10!==e)if(4!==e)if(5!==e)if(6!==e)if(8!==e)if(7!==e);else{const e=this;dd.device.notification.confirm({message:"是否确定删除此事件?",title:"提示",buttonLabels:["取消","确定"],onSuccess(t){1===t.buttonIndex&&dd.device.notification.showPreloader({text:"删除中..",showIcon:!0,async onSuccess(t){const n=await Object(c["v"])({id:e.id});dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}}),n.success&&dd.alert({message:n.message?n.message:"操作成功",title:"提示",button:"收到"}).then(t=>{e.$router.go(-1)}).catch(e=>{})},onFail:function(e){}})},onFail:function(e){}})}else this.$router.push(`confirm?i=${e}&id=${this.id}&handleDepartmentId=${this.detail.handleDepartmentId}&firstDepartmentId=${this.detail.firstDepartmentId}`);else this.$router.push(`confirm?i=${e}&id=${this.id}&handleDepartmentId=${this.detail.handleDepartmentId}`);else{const e={eventId:this.detail.id,operationType:10,editDepartmentId:this.detail.firstDepartmentId},t=this;dd.device.notification.prompt({message:"处理意见",title:"退回",buttonLabels:["取消","确认"],async onSuccess(n){if(!n.buttonIndex)return;e.remark=n.value;const i=await Object(c["l"])(e);i.success&&dd.alert({message:i.message?i.message:"操作成功",title:"提示",button:"收到"}).then(e=>{t.$router.go(-1)}).catch(e=>{})},onFail:function(e){}})}else{const e={eventId:this.detail.id,operationType:9,editDepartmentId:this.detail.firstDepartmentId,departmentId:this.detail.handleDepartmentId},t=this;dd.device.notification.confirm({message:"是否确定撤回此事件?",title:"提示",buttonLabels:["取消","确定"],onSuccess(n){1===n.buttonIndex&&dd.device.notification.showPreloader({text:"处理中..",showIcon:!0,async onSuccess(n){const i=await Object(c["l"])(e);dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}}),i.success&&dd.alert({message:i.message?i.message:"操作成功",title:"提示",button:"收到"}).then(e=>{t.$router.go(-1)}).catch(e=>{})},onFail:function(e){}})},onFail:function(e){}})}else{const e=this;dd.device.notification.confirm({message:"是否确定签收?",title:"提示",buttonLabels:["取消","确定"],onSuccess(t){1===t.buttonIndex&&dd.device.notification.showPreloader({text:"处理中..",showIcon:!0,async onSuccess(t){const n=await Object(c["Vb"])({id:e.signData.id});dd.device.notification.hidePreloader({onSuccess:function(e){},onFail:function(e){}}),n.success&&dd.alert({message:n.message?n.message:"操作成功",title:"提示",button:"收到"}).then(t=>{e.getDetail(),e.getMore(),e.getHandleRole()}).catch(e=>{})},onFail:function(e){}})},onFail:function(e){}})}else this.$router.push(`add?id=${this.id}&type=${this.type}`);else this.$router.push(`confirm?i=${e}&id=${this.id}&handleType=${this.detail.handleType}&handleDepartmentId=${this.detail.handleDepartmentId}`)},checkRight(e,t,n){return this.right.includes(e)||t&&this.right.includes(t)||n&&this.right.includes(n)}}},d=r,o=(n("95b6"),n("2877")),l=Object(o["a"])(d,i,a,!1,null,"30318bc7",null);t["default"]=l.exports},"95b6":function(e,t,n){"use strict";n("f494")},"9fdc":function(e,t,n){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tab_warp"},e._l(e.tabs,(function(n,i){return t("span",{directives:[{name:"show",rawName:"v-show",value:!n.hide,expression:"!v.hide"}],key:i,class:e.index===i+1?"active":"",on:{click:function(t){return e.checkTab(i)}}},[e._v(e._s(n.name))])})),0)},a=[],s={props:["tabs","tabIndex"],data(){return{index:this.tabIndex}},mounted(){},methods:{checkTab(e){this.index!==e+1&&(this.index=e+1,this.$emit("changeIndex",this.index))}}},c=s,r=(n("e9e9"),n("2877")),d=Object(r["a"])(c,i,a,!1,null,"d765f7f0",null);t["a"]=d.exports},e4d4:function(e,t,n){},e9e9:function(e,t,n){"use strict";n("e4d4")},f494:function(e,t,n){}}]);