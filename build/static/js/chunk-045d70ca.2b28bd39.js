(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-045d70ca"],{"7eae":function(e,t,a){},8261:function(e,t,a){"use strict";a("7eae")},fdca:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"reportedAdd_warp mapClass"},[t("div",{staticClass:"form",class:e.edit?"":"unclick"},[t("div",{staticClass:"item"},[t("p",{staticClass:"active"},[e._v("上报人员")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.userInfo.name,expression:"userInfo.name"}],attrs:{type:"text",readonly:"",placeholder:"在此输入上报人员"},domProps:{value:e.userInfo.name},on:{input:function(t){t.target.composing||e.$set(e.userInfo,"name",t.target.value)}}})]),t("div",{staticClass:"item"},[t("p",{class:e.formData.title?"active":""},[e._v("事件名称")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.title,expression:"formData.title",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"在此输入事件名称"},domProps:{value:e.formData.title},on:{input:function(t){t.target.composing||e.$set(e.formData,"title",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item"},[t("p",{class:e.formData.incidentTime?"active":""},[e._v("上报时间")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.formData.incidentTime,expression:"formData.incidentTime",modifiers:{trim:!0}}],attrs:{type:"text",readonly:"",placeholder:"点击选择上报时间"},domProps:{value:e.formData.incidentTime},on:{click:e.incidentTimeFn,input:function(t){t.target.composing||e.$set(e.formData,"incidentTime",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"item"},[t("p",{class:e.formData.eventType?"active":""},[e._v("事件类别")]),t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.eventTypeName,expression:"formData.eventTypeName"}],attrs:{readonly:"",type:"text",placeholder:"点击选择事件类别"},domProps:{value:e.formData.eventTypeName},on:{click:e.eventTypeFn,input:function(t){t.target.composing||e.$set(e.formData,"eventTypeName",t.target.value)}}})])]),t("div",{staticClass:"item"},[t("p",{class:e.formData.earlyWarningLevel?"active":""},[e._v("事件等级")]),t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.earlyWarningLevelName,expression:"formData.earlyWarningLevelName"}],attrs:{readonly:"",type:"text",placeholder:"点击选择事件等级"},domProps:{value:e.formData.earlyWarningLevelName},on:{click:e.earlyWarningLevelFn,input:function(t){t.target.composing||e.$set(e.formData,"earlyWarningLevelName",t.target.value)}}})])]),t("div",{staticClass:"item"},[t("p",{class:e.formData.sourceType?"active":""},[e._v("事件来源")]),t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.sourceTypeName,expression:"formData.sourceTypeName"}],attrs:{readonly:"",type:"text",placeholder:"事件来源"},domProps:{value:e.formData.sourceTypeName},on:{click:e.sourceIdFn,input:function(t){t.target.composing||e.$set(e.formData,"sourceTypeName",t.target.value)}}})])]),t("div",{staticClass:"item"},[t("p",{class:e.formData.sourceType?"active":""},[e._v("现实行为")]),t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.sourceTypeName,expression:"formData.sourceTypeName"}],attrs:{readonly:"",type:"text",placeholder:"现实行为"},domProps:{value:e.formData.sourceTypeName},on:{click:e.sourceIdFn,input:function(t){t.target.composing||e.$set(e.formData,"sourceTypeName",t.target.value)}}})])]),t("div",{staticClass:"item"},[t("p",{class:e.formData.roadId?"active":""},[e._v("所属街道")]),t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.roadName,expression:"formData.roadName"}],attrs:{readonly:"",type:"text",placeholder:"所属街道"},domProps:{value:e.formData.roadName},on:{click:e.roadIdFn,input:function(t){t.target.composing||e.$set(e.formData,"roadName",t.target.value)}}})])]),t("div",{staticClass:"item"},[t("p",{class:e.formData.incidentContent?"active":""},[e._v("事件描述")]),t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.incidentContent,expression:"formData.incidentContent"}],attrs:{type:"text",placeholder:"事件描述"},domProps:{value:e.formData.incidentContent},on:{input:function(t){t.target.composing||e.$set(e.formData,"incidentContent",t.target.value)}}})])]),t("div",{staticClass:"item"},[t("p",{class:e.formData.incidentAddress?"active":""},[e._v("事件地址")]),t("div",[t("input",{attrs:{type:"text",readonly:"",placeholder:"点击选择事件地址"},domProps:{value:e.formData.incidentAddress},on:{click:e.incidentAddressFn}})])]),t("div",{staticClass:"item"},[t("p",{class:e.files.length>0?"active":""},[e._v("照片")]),t("div",{staticClass:"item_main"},[e._l(e.files,(function(a,n){return t("span",{key:n,staticStyle:{position:"relative"}},[t("img",{attrs:{src:e.url_+"rbac/file/downloadRb/"+a.fileId+"?rbacToken="+e.rbacToken_}}),t("i",{staticClass:"iconfont icon-cha2",on:{click:function(t){return e.delFile(n)}}})])})),e.files.length<5?t("span",[t("button",{staticStyle:{background:"#d7d7d7"}},[e._v(" 上传 "),t("input",{attrs:{multiple:"",type:"file",name:"",id:""},on:{change:e.fileChange}})])]):e._e()],2)])]),t("div",{staticClass:"btn"},[t("span",{on:{click:function(t){return e.handClick(1)}}},[e._v("保存")])])])},o=[],i=(a("14d9"),a("c198")),r={data(){return{url_:"",rbacToken_:"",eventData:[],levelData:[],sourceData:[],roadData:[],userInfo:{},id:this.$route.query.id,index:[],edit:!0,files:[],formData:{id:"",title:"",eventType:"",eventTypeName:"",incidentTime:"",earlyWarningLevel:"",earlyWarningLevelName:"",sourceType:"401",sourceTypeName:"现场排查",incidentContent:"",incidentAddress:"",roadId:"",roadName:"",x:"120.991617",y:"28.119125",trends:"",measuresTaken:"",incidentRemark:""}}},computed:{streetList(){return this.$store.state.common.streetList},streetOption(){return this.$store.state.common.streetList.map(e=>e.name)},actionList(){return this.$store.state.common.actionList},actionOption(){return this.$store.state.common.actionList.map(e=>e.name)},eventList(){return this.$store.state.common.eventList},eventOption(){return this.$store.state.common.eventList.map(e=>e.name)}},created(){const e=this;e.url_=Object({NODE_ENV:"production",VUE_APP_ENV:"production",BASE_URL:""}).baseUrl,e.rbacToken_=e.$store.getters.rbacToken||localStorage.getItem("rbacToken"),e.userInfo=localStorage.userInfo?JSON.parse(localStorage.userInfo):{};let t=this.$store.state;e.eventData=t.eventData,e.levelData=t.levelData,e.sourceData=t.sourceData,e.roadData=t.roadData,e.formData.incidentTime=e.D(),e.getGeolocationFn(),this.$nextTick(()=>{}),dd.disablePullToRefresh().then(e=>{}).catch(e=>{})},methods:{roadIdFn(){const e=this;dd.showSelect({source:e.roadData}).then(t=>{e.formData.roadId=t.value,e.formData.roadName=t.key}).catch(e=>{})},incidentTimeFn(){},eventTypeFn(){const e=this;dd.showSelect({source:e.eventData}).then(t=>{e.formData.eventType=t.value,e.formData.eventTypeName=t.key}).catch(e=>{})},sourceIdFn(){const e=this;dd.showSelect({source:e.sourceData}).then(t=>{e.formData.sourceType=t.value,e.formData.sourceTypeName=t.key}).catch(e=>{})},incidentAddressFn(){const e=this;dd.locateOnMap({longitude:e.formData.x?e.formData.x:120.9661,latitude:e.formData.y?e.formData.y:28.1206}).then(t=>{let a=t.province+t.city+t.adName+t.title;e.formData.incidentAddress=a,e.formData.x=t.longitude,e.formData.y=t.latitude}).catch(e=>{})},getGeolocationFn(){const e=this;dd.getGeolocation({targetAccuracy:200,coordinate:1,withReGeocode:!0,useCache:!1}).then(async t=>{e.formData.incidentAddress=t.address,e.formData.x=t.longitude,e.formData.y=t.latitude}).catch(e=>{})},earlyWarningLevelFn(){const e=this;dd.showSelect({source:e.levelData}).then(t=>{e.formData.earlyWarningLevel=t.value,e.formData.earlyWarningLevelName=t.key}).catch(e=>{})},handClick(e){const t=this,a=t.validateFn();a&&dd.confirm({title:"温馨提示",message:"确定提交？",buttonLabels:["取消","确定"]}).then(async e=>{if(1==e.buttonIndex){const e=await Object(i["f"])({event:t.formData,fileList:t.files});e.success&&dd.toast({icon:"success",text:"操作成功"}).then(e=>{t.$router.go(-1)}).catch(e=>{})}}).catch(e=>{})},async fileChange(e){const t=this;let a=new FormData,n=[...e.target.files];if(t.showLoadingFn(),n&&n.length){n.forEach(e=>{a.append("file",e)}),a.append("rbacToken",localStorage.getItem("rbacToken"));const e=await Object(i["gc"])(a);e.success&&(e.data&&e.data.length&&e.data.forEach((e,a)=>{var o={};o.fileType=n[a].type,o.fileName=n[a].name,o.fileId=e,t.files.push(o)}),t.hideLoadingFn())}},delFile(e){this.files.splice(e,1)},showLoadingFn(){dd.showLoading({text:"加载中"}).then(e=>{}).catch(e=>{})},hideLoadingFn(){dd.hideLoading({}).then(e=>{}).catch(e=>{})},validateFn(){const e=this;return e.formData.title?e.formData.eventType?e.formData.earlyWarningLevel?e.formData.roadId?e.formData.sourceType?!!e.formData.incidentContent||(e.alert("请输入事件描述"),!1):(e.alert("请输入事件来源"),!1):(e.alert("请输入所属街道"),!1):(e.alert("请输入事件等级"),!1):(e.alert("请输入事件类别"),!1):(e.alert("请输入事件名称"),!1)},alert(e){dd.alert({message:e,title:"提示",button:"收到"}).then(e=>{}).catch(e=>{})}}},s=r,c=(a("8261"),a("2877")),l=Object(c["a"])(s,n,o,!1,null,"b59a2542",null);t["default"]=l.exports}}]);