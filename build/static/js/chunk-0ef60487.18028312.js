(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0ef60487"],{3560:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"event_warp"},[e("div",{staticClass:"tab"},[e("Nav",{attrs:{tabs:t.tabs,tabIndex:t.tabIndex},on:{changeIndex:t.changeIndex}})],1),e("div",{staticClass:"topHolder"}),e("div",{staticClass:"subTab"}),e("div",{directives:[{name:"show",rawName:"v-show",value:1===t.tabIndex,expression:"tabIndex === 1"}],staticClass:"detailMsg"},[e("ul",{staticClass:"ul"},[e("li",{staticClass:"li"},[e("span",[t._v("被检查单位")]),e("div",[t._v(t._s(t.detail.checkTarget))])]),e("li",[e("span",[t._v("时间")]),e("div",[t._v(t._s(t.detail.incidentTime))])]),e("li",[e("span",[t._v("检查单位")]),e("div",[t._v(t._s(t.detail.roadName))])]),e("li",[e("span",[t._v("所属地点")]),e("div",[t._v(t._s(t.detail.incidentAddress))])]),t._l(t.question,(function(a,i){return e("div",{key:i},[e("li",[e("span",[t._v(t._s(1==a.type?"检查项":2==a.type?"所属类目":3==a.type?"存在问题":""))]),e("div",[t._v(t._s(a.otherContent))])]),e("li",{directives:[{name:"show",rawName:"v-show",value:a.safetyDepartmentName,expression:"item.safetyDepartmentName"}]},[e("span",[t._v("部门单位")]),e("div",[t._v(t._s(a.safetyDepartmentName))])]),e("li",{directives:[{name:"show",rawName:"v-show",value:a.textDescription,expression:"item.textDescription"}]},[e("span",[t._v("文字描述")]),e("div",[t._v(t._s(a.textDescription))])])])})),e("div",{staticClass:"file-box"},[e("li",{directives:[{name:"show",rawName:"v-show",value:t.handleList&&t.handleList.length>0,expression:"handleList && handleList.length > 0"}]},[e("span",[t._v("附件信息")])]),t._l(t.handleList,(function(a,i){return e("div",{key:i},[e("li",[e("div",{staticClass:"title"},[t._v(t._s(i+1))]),e("i",[t._v(t._s(a.createTime))])]),e("li",[e("div",[e("span",[t._v("附件信息")]),e("p",{on:{click:function(e){return t.preview(a)}}},[t._v(t._s(a.fileName))])])]),e("li",[e("span",[t._v("上传人")]),e("div",[t._v(t._s(a.createUserName))])])])}))],2)],2)]),e("div",{directives:[{name:"show",rawName:"v-show",value:2===t.tabIndex,expression:"tabIndex === 2"}],staticClass:"schedule"},[e("div",{staticClass:"safetyAdd_warp"},[e("div",{staticClass:"form"},[e("div",{staticClass:"item"},[e("p",{class:t.formData.checkPerson?"active":""},[t._v("检查人")]),e("div",{staticClass:"address"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.checkPerson,expression:"formData.checkPerson"}],attrs:{readonly:"",type:"text",placeholder:"输入检查人"},domProps:{value:t.formData.checkPerson},on:{input:function(e){e.target.composing||t.$set(t.formData,"checkPerson",e.target.value)}}})])]),e("div",{staticClass:"item"},[e("p",{class:t.formData.checkDate?"active":""},[t._v("整改时间")]),e("input",{directives:[{name:"show",rawName:"v-show",value:!t.isDetail,expression:"!isDetail"}],attrs:{type:"text",readonly:"",placeholder:"点击选择时间"},domProps:{value:t.formData.checkDate},on:{click:t.selectTime}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isDetail,expression:"isDetail"}]},[t._v(" "+t._s(t.formData.checkDate?t.formData.checkDate.split(" ")[0]:"")+" ")])]),e("div",{staticClass:"item"},[e("p",{class:t.formData.rectifyContent?"active":""},[t._v("整改详情")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.rectifyContent,expression:"formData.rectifyContent"},{name:"show",rawName:"v-show",value:!t.isDetail,expression:"!isDetail"}],attrs:{type:"text",placeholder:"整改详情"},domProps:{value:t.formData.rectifyContent},on:{input:function(e){e.target.composing||t.$set(t.formData,"rectifyContent",e.target.value)}}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isDetail,expression:"isDetail"}]},[t._v(" "+t._s(t.formData.rectifyContent?t.formData.rectifyContent:"")+" ")])]),e("div",{staticClass:"item"},[e("p",{class:t.formData.files.length>0?"active":""},[t._v("照片")]),e("div",{staticClass:"item_main"},[t._l(t.formData.files,(function(a,i){return e("span",{key:i,staticStyle:{position:"relative"}},[e("span",{staticStyle:{border:"1px solid #e0e0e0",display:"inline-block"},on:{click:function(e){return t.preview_detail(a)}}},[e("img",{attrs:{src:t.url_+"rbac/file/downloadRb/"+a+"?rbacToken="+t.rbacToken_,alt:""}})]),t.isDetail?t._e():e("i",{staticClass:"iconfont icon-cha2",on:{click:function(e){return t.delFile(t.i)}}})])})),t.files.length<5&&!t.isDetail?e("span",[e("button",{staticStyle:{background:"#d7d7d7"}},[t._v(" 上传 "),e("input",{attrs:{multiple:"",type:"file",name:"",id:""},on:{change:t.fileChange}})])]):t._e()],2)])]),e("div",{staticClass:"endHolder"}),e("div",{staticClass:"btn"},[t.isDetail?t._e():e("span",{on:{click:function(e){return t.handClick(1)}}},[t._v("上报")])])])]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showImg,expression:"showImg"}],staticClass:"preview",on:{click:function(e){t.showImg=!1}}},[e("img",{attrs:{src:t.previewUrl,alt:""}})]),e("div",{staticClass:"endHolder"})])},s=[],n=(a("14d9"),a("9fdc")),r=a("b893"),o=a("c198"),c={name:"detail",components:{Nav:n["a"]},data(){return{showImg:!1,previewUrl:"",baseUrl:Object({NODE_ENV:"production",VUE_APP_ENV:"production",BASE_URL:""}).baseUrl,loading:!1,noMore:[!1,!1,!1,!1,!1,!1],tabs:[{name:"事件详情"},{name:"整改详情"}],tabIndex:1,id:this.$route.query.id,detail:{},question:[],handleList:[],fileList:[],leaderHandleList:[],signData:{},isDetail:0,detailData:[],formData:{checkPerson:JSON.parse(localStorage.getItem("userInfo")).name,checkDate:"",rectifyContent:"",files:[],handleFilesListStr:[],problemList:[],eventId:this.$route.query.id},files:[],url_:Object({NODE_ENV:"production",VUE_APP_ENV:"production",BASE_URL:""}).baseUrl,rbacToken_:this.$store.getters.rbacToken||localStorage.getItem("rbacToken"),distanceStatus:!1}},async created(){const t=this,e=new Date,a=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,0)}-${String(e.getDate()).padStart(2,0)}`;t.formData.checkDate=a,t.getDetail()},methods:{async fileChange(t){let e=new FormData;const a=[...t.target.files];let i=this.files.length;if(dd.device.notification.showPreloader({text:"文件上传中..",showIcon:!1,onSuccess(t){dd.device.notification.hidePreloader({onSuccess:function(t){},onFail:function(t){}})}}),dd.device.notification.hidePreloader(),a&&a.length){if(a.length>5)return this.alert("最多只能上传5张").call(this),!1;if(i+a.length>5)return this.alert("最多只能上传5张").call(this),!1;a.forEach((t,a)=>{e.append("file",t)}),e.append("rbacToken",localStorage.getItem("rbacToken"));const t=await Object(o["gc"])(e);t.success&&(t.data.map((t,e)=>{this.formData.files.push(t)}),t.data.forEach((t,e)=>{var i={};i.fileType=a[e].type,i.fileName=a[e].name,i.fileId=t,this.files.push(i)}))}},delFile(t){this.formData.files.splice(t,1),this.files.splice(t,1)},selectTime(){const t=this;dd.showDatePicker({format:"yyyy-MM-dd",value:t.formData.checkDate}).then(e=>{t.formData.checkDate=e.value}).catch(t=>{})},preview_detail(t){this.showImg=!0,this.previewUrl=`${this.baseUrl}rbac/file/downloadRb/${t}?rbacToken=${localStorage.getItem("rbacToken")}`},preview(t){this.showImg=!0,this.previewUrl=`${this.baseUrl}rbac/file/downloadRb/${t.fileId}?rbacToken=${localStorage.getItem("rbacToken")}`},alert(t){dd.device.notification.alert({message:t,title:"提示",buttonName:"确定"})},async getDetail(){const t=this,[e,a,i,s,n]=await Promise.all([Object(o["ab"])({id:t.$route.query.id,parentAuthName:"peaceIncident:statisticsManagement",authType:1}),Object(o["ub"])({eventId:t.$route.query.id}),Object(o["bc"])({eventId:t.$route.query.id}),Object(o["vb"])({eventId:t.$route.query.id}),Object(o["wb"])({eventId:t.$route.query.id})]);if(e.success&&(t.detail=e.data,t.detail.handType&&(t.tabs=[{name:"事件详情"}]),dd.getGeolocation({targetAccuracy:200,coordinate:1,withReGeocode:!0,useCache:!1}).then(e=>{let a=r["a"].gcj_decrypt(e.latitude,e.longitude),i=t.M({lng1:t.detail.x?t.detail.x:0,lat1:t.detail.y?t.detail.y:0,lng2:a.lon?a.lon:0,lat2:a.lat?a.lat:0});t.distanceStatus=!(i>500)}).catch(t=>{})),a.success){t.question=a.data;let e=0;t.question.map((t,a)=>{3==t.type&&(e+=1)}),0==e&&t.question.push({type:3,otherContent:"无问题"})}i.success&&(t.handleList=i.data),s.success&&(t.formData.problemList=s.data.map(t=>(t.rectifyStatus=3,t))),n.success&&n.data.length>0&&(t.isDetail=n.data[0].status,t.formData.checkDate=n.data[0].checkDate,t.formData.files=JSON.parse(n.data[0].files),t.formData.rectifyContent=n.data[0].rectifyContent)},handClick(){const t=this;if(!t.distanceStatus)return alert("超出范围"),!1;dd.device.notification.confirm({message:"确定上报？",title:"提示",buttonLabels:["取消","确定"],async onSuccess(e){if(1==e.buttonIndex){const e=await Object(o["Wb"])(t.formData);1==e.success&&dd.device.notification.toast({text:"操作成功",duration:1.5,onSuccess(e){t.$router.go(-1)},onFail:function(t){}})}},onFail:function(t){}})},changeIndex(t){this.tabIndex!==t&&(window.scrollTo(0,0),this.tabIndex=t)},loadMore(){}}},l=c,d=(a("4818"),a("2877")),h=Object(d["a"])(l,i,s,!1,null,"5b9be5b6",null);e["default"]=h.exports},4818:function(t,e,a){"use strict";a("da5e")},"9fdc":function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"tab_warp"},t._l(t.tabs,(function(a,i){return e("span",{directives:[{name:"show",rawName:"v-show",value:!a.hide,expression:"!v.hide"}],key:i,class:t.index===i+1?"active":"",on:{click:function(e){return t.checkTab(i)}}},[t._v(t._s(a.name))])})),0)},s=[],n={props:["tabs","tabIndex"],data(){return{index:this.tabIndex}},mounted(){},methods:{checkTab(t){this.index!==t+1&&(this.index=t+1,this.$emit("changeIndex",this.index))}}},r=n,o=(a("e9e9"),a("2877")),c=Object(o["a"])(r,i,s,!1,null,"d765f7f0",null);e["a"]=c.exports},b893:function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));const i={PI:3.141592653589793,x_pi:52.35987755982988,delta:function(t,e){var a=6378245,i=.006693421622965943,s=this.transformLat(e-105,t-35),n=this.transformLon(e-105,t-35),r=t/180*this.PI,o=Math.sin(r);o=1-i*o*o;var c=Math.sqrt(o);return s=180*s/(a*(1-i)/(o*c)*this.PI),n=180*n/(a/c*Math.cos(r)*this.PI),{lat:s,lon:n}},gcj_encrypt:function(t,e){if(this.outOfChina(t,e))return{lat:t,lon:e};var a=this.delta(t,e);return{lat:t+a.lat,lon:e+a.lon}},gcj_decrypt:function(t,e){if(this.outOfChina(t,e))return{lat:t,lon:e};var a=this.delta(t,e);return{lat:t-a.lat,lon:e-a.lon}},gcj_decrypt_exact:function(t,e){var a,i,s=.01,n=1e-9,r=s,o=s,c=t-r,l=e-o,d=t+r,h=e+o,u=0;while(1){a=(c+d)/2,i=(l+h)/2;var v=this.gcj_encrypt(a,i);if(r=v.lat-t,o=v.lon-e,Math.abs(r)<n&&Math.abs(o)<n)break;if(r>0?d=a:c=a,o>0?h=i:l=i,++u>1e4)break}return{lat:a,lon:i}},bd_encrypt:function(t,e){var a=e,i=t,s=Math.sqrt(a*a+i*i)+2e-5*Math.sin(i*this.x_pi),n=Math.atan2(i,a)+3e-6*Math.cos(a*this.x_pi);return bdLon=s*Math.cos(n)+.0065,bdLat=s*Math.sin(n)+.006,{lat:bdLat,lon:bdLon}},bd_decrypt:function(t,e){var a=e-.0065,i=t-.006,s=Math.sqrt(a*a+i*i)-2e-5*Math.sin(i*this.x_pi),n=Math.atan2(i,a)-3e-6*Math.cos(a*this.x_pi),r=s*Math.cos(n),o=s*Math.sin(n);return{lat:o,lon:r}},mercator_encrypt:function(t,e){var a=20037508.34*e/180,i=Math.log(Math.tan((90+t)*this.PI/360))/(this.PI/180);return i=20037508.34*i/180,{lat:i,lon:a}},mercator_decrypt:function(t,e){var a=e/20037508.34*180,i=t/20037508.34*180;return i=180/this.PI*(2*Math.atan(Math.exp(i*this.PI/180))-this.PI/2),{lat:i,lon:a}},distance:function(t,e,a,i){var s=6371e3,n=Math.cos(t*this.PI/180)*Math.cos(a*this.PI/180)*Math.cos((e-i)*this.PI/180),r=Math.sin(t*this.PI/180)*Math.sin(a*this.PI/180),o=n+r;o>1&&(o=1),o<-1&&(o=-1);var c=Math.acos(o),l=c*s;return l},outOfChina:function(t,e){return e<72.004||e>137.8347||(t<.8293||t>55.8271)},transformLat:function(t,e){var a=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return a+=2*(20*Math.sin(6*t*this.PI)+20*Math.sin(2*t*this.PI))/3,a+=2*(20*Math.sin(e*this.PI)+40*Math.sin(e/3*this.PI))/3,a+=2*(160*Math.sin(e/12*this.PI)+320*Math.sin(e*this.PI/30))/3,a},transformLon:function(t,e){var a=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return a+=2*(20*Math.sin(6*t*this.PI)+20*Math.sin(2*t*this.PI))/3,a+=2*(20*Math.sin(t*this.PI)+40*Math.sin(t/3*this.PI))/3,a+=2*(150*Math.sin(t/12*this.PI)+300*Math.sin(t/30*this.PI))/3,a}}},da5e:function(t,e,a){},e4d4:function(t,e,a){},e9e9:function(t,e,a){"use strict";a("e4d4")}}]);